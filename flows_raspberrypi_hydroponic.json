[
    {
        "id": "1d22c714.e50369",
        "type": "tab",
        "label": "GET Telemetry",
        "disabled": false,
        "info": ""
    },
    {
        "id": "87cb301d.9893c",
        "type": "tab",
        "label": "POST ",
        "disabled": false,
        "info": ""
    },
    {
        "id": "5127740.f28848c",
        "type": "tab",
        "label": "System rules",
        "disabled": false,
        "info": ""
    },
    {
        "id": "20c682c8.b59efe",
        "type": "tab",
        "label": "Flow 1",
        "disabled": false,
        "info": ""
    },
    {
        "id": "a0e631b8.d383b",
        "type": "mqtt-broker",
        "name": "Mosquitto",
        "broker": "localhost",
        "port": "1883",
        "clientid": "",
        "usetls": false,
        "compatmode": false,
        "keepalive": "60",
        "cleansession": true,
        "birthTopic": "",
        "birthQos": "0",
        "birthPayload": "",
        "closeTopic": "",
        "closeQos": "0",
        "closePayload": "",
        "willTopic": "",
        "willQos": "0",
        "willPayload": ""
    },
    {
        "id": "8193652c.e6bda8",
        "type": "influxdb",
        "hostname": "127.0.0.1",
        "port": "8086",
        "protocol": "http",
        "database": "hydro",
        "name": "",
        "usetls": false,
        "tls": "",
        "influxdbVersion": "1.x",
        "url": "http://localhost:8086",
        "rejectUnauthorized": true
    },
    {
        "id": "352c089f.6b44d8",
        "type": "ui_tab",
        "name": "Hydroponic",
        "icon": "dashboard",
        "disabled": false,
        "hidden": false
    },
    {
        "id": "f0e58282.f2736",
        "type": "ui_group",
        "name": "Seed Tray - Visualize",
        "tab": "352c089f.6b44d8",
        "order": 5,
        "disp": true,
        "width": "26",
        "collapse": false,
        "info": "# Seed tray LEDs"
    },
    {
        "id": "8a9b009f.1b35d",
        "type": "ui_group",
        "name": "Room environment - Sensors",
        "tab": "352c089f.6b44d8",
        "order": 3,
        "disp": true,
        "width": "6",
        "collapse": false
    },
    {
        "id": "65d119b5.66cb78",
        "type": "ui_group",
        "name": "Seed Tray - Sensors",
        "tab": "352c089f.6b44d8",
        "order": 4,
        "disp": true,
        "width": "12",
        "collapse": false
    },
    {
        "id": "1c37dc0b.ce28e4",
        "type": "ui_group",
        "name": "Weather forecast",
        "tab": "352c089f.6b44d8",
        "order": 1,
        "disp": true,
        "width": 20,
        "collapse": false
    },
    {
        "id": "72b67add.961f74",
        "type": "ui_group",
        "name": "Seed tray - Schedules",
        "tab": "352c089f.6b44d8",
        "order": 6,
        "disp": true,
        "width": "7",
        "collapse": false
    },
    {
        "id": "e8854cf5.bbc99",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "",
        "order": 5,
        "width": 2,
        "height": 1
    },
    {
        "id": "8abb8d14.1da7c",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "",
        "order": 7,
        "width": 1,
        "height": 1
    },
    {
        "id": "c9f3a157.d0af7",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "",
        "order": 9,
        "width": 2,
        "height": 1
    },
    {
        "id": "e5be2d4e.0683",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "",
        "order": 3,
        "width": 7,
        "height": 1
    },
    {
        "id": "c9066fca.cee52",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "",
        "order": 4,
        "width": 7,
        "height": 1
    },
    {
        "id": "2ee23605.85e39a",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "",
        "order": 5,
        "width": 7,
        "height": 1
    },
    {
        "id": "cf3c4bd4.b57d78",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "",
        "order": 8,
        "width": 7,
        "height": 1
    },
    {
        "id": "d3290ae7.21fe98",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "",
        "order": 6,
        "width": 6,
        "height": 1
    },
    {
        "id": "2de4a264.b5f62e",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "",
        "order": 7,
        "width": 6,
        "height": 1
    },
    {
        "id": "60a0073d.7b0198",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "",
        "order": 8,
        "width": 6,
        "height": 1
    },
    {
        "id": "6dc911ee.ea694",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "",
        "order": 5,
        "width": 2,
        "height": 1
    },
    {
        "id": "27ff61b6.64ceee",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "",
        "order": 7,
        "width": 1,
        "height": 1
    },
    {
        "id": "d68d5539.9f7388",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "",
        "order": 9,
        "width": 2,
        "height": 1
    },
    {
        "id": "25301e7.4048be2",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "",
        "order": 3,
        "width": 7,
        "height": 1
    },
    {
        "id": "4e20bf36.aee24",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "",
        "order": 4,
        "width": 7,
        "height": 1
    },
    {
        "id": "cd177d02.fcb47",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "",
        "order": 5,
        "width": 7,
        "height": 1
    },
    {
        "id": "55e06fae.59f7f",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "",
        "order": 8,
        "width": 7,
        "height": 1
    },
    {
        "id": "d04eaa91.a399f8",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "",
        "order": 6,
        "width": 6,
        "height": 1
    },
    {
        "id": "39ffd0d.5f55a3",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "",
        "order": 7,
        "width": 6,
        "height": 1
    },
    {
        "id": "d50ed20d.eaca2",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "",
        "order": 8,
        "width": 6,
        "height": 1
    },
    {
        "id": "f8e5458c.a3e458",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "",
        "order": 5,
        "width": 2,
        "height": 1
    },
    {
        "id": "2e5354b4.fa9efc",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "",
        "order": 8,
        "width": 3,
        "height": 1
    },
    {
        "id": "55451708.9195b8",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "",
        "order": 4,
        "width": 2,
        "height": 1
    },
    {
        "id": "8a9743e3.77e45",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "",
        "order": 6,
        "width": 2,
        "height": 1
    },
    {
        "id": "cd7c0825.8eea08",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "",
        "order": 7,
        "width": 7,
        "height": 1
    },
    {
        "id": "b116a7ee.4a8928",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "",
        "order": 6,
        "width": 6,
        "height": 1
    },
    {
        "id": "ac904da2.49289",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "",
        "order": 7,
        "width": 6,
        "height": 1
    },
    {
        "id": "d031979b.9eb4d8",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "",
        "order": 9,
        "width": 6,
        "height": 1
    },
    {
        "id": "d7b17763.6bfd98",
        "type": "ui_base",
        "theme": {
            "name": "theme-light",
            "lightTheme": {
                "default": "#0094CE",
                "baseColor": "#1dba08",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "edited": true,
                "reset": false
            },
            "darkTheme": {
                "default": "#097479",
                "baseColor": "#097479",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "edited": true,
                "reset": false
            },
            "customTheme": {
                "name": "Untitled Theme 1",
                "default": "#4B7930",
                "baseColor": "#4B7930",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"
            },
            "themeState": {
                "base-color": {
                    "default": "#0094CE",
                    "value": "#1dba08",
                    "edited": true
                },
                "page-titlebar-backgroundColor": {
                    "value": "#1dba08",
                    "edited": false
                },
                "page-backgroundColor": {
                    "value": "#fafafa",
                    "edited": false
                },
                "page-sidebar-backgroundColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "group-textColor": {
                    "value": "#33f519",
                    "edited": false
                },
                "group-borderColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "group-backgroundColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "widget-textColor": {
                    "value": "#111111",
                    "edited": false
                },
                "widget-backgroundColor": {
                    "value": "#1dba08",
                    "edited": false
                },
                "widget-borderColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "base-font": {
                    "value": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"
                }
            },
            "angularTheme": {
                "primary": "indigo",
                "accents": "blue",
                "warn": "red",
                "background": "grey"
            }
        },
        "site": {
            "name": "Node-RED Dashboard",
            "hideToolbar": "false",
            "allowSwipe": "false",
            "lockMenu": "false",
            "allowTempTheme": "none",
            "dateFormat": "DD/MM/YYYY",
            "sizes": {
                "sx": 48,
                "sy": 48,
                "gx": 12,
                "gy": 12,
                "cx": 0,
                "cy": 0,
                "px": 0,
                "py": 0
            }
        }
    },
    {
        "id": "ae8ddbfd.c58db8",
        "type": "ui_group",
        "name": "System control",
        "tab": "352c089f.6b44d8",
        "order": 2,
        "disp": true,
        "width": 4,
        "collapse": true
    },
    {
        "id": "9f76d55b.b58878",
        "type": "remote-config",
        "name": "Node-RED UI",
        "host": "10.0.0.10",
        "protocol": "http",
        "port": "1880",
        "baseurl": "/ui",
        "instancehash": "ktr0ugw85xjlfnbdbck3dtjhkq75ke5s6m3a8rvyw6rlfpvd75eaikzfcaloh1xj",
        "server": "nodered02.remote-red.com",
        "region": "de"
    },
    {
        "id": "d1c9d5e1.84cd88",
        "type": "remote-config",
        "name": "Node-RED UI",
        "host": "10.0.0.10",
        "protocol": "http",
        "port": "1880",
        "baseurl": "/ui",
        "instancehash": "tn0e1h0zfv6e8j8ihfdatlcfe245y08mbtl176ivq31mipbz8z2yvmmmwrfblami",
        "server": "nodered02.remote-red.com",
        "region": "de"
    },
    {
        "id": "8d4aab9b.4d6328",
        "type": "ui_group",
        "name": "Seed tray - Devices",
        "tab": "352c089f.6b44d8",
        "order": 7,
        "disp": true,
        "width": 7,
        "collapse": false
    },
    {
        "id": "c9b3db5b.545828",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "bdf4ab4f.fa8958",
        "order": 3,
        "width": 1,
        "height": 1
    },
    {
        "id": "817f3f37.e3851",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "bdf4ab4f.fa8958",
        "order": 4,
        "width": 1,
        "height": 1
    },
    {
        "id": "f0e56970.626d48",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "bdf4ab4f.fa8958",
        "order": 6,
        "width": 1,
        "height": 1
    },
    {
        "id": "c33dc565.8c19d8",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "bdf4ab4f.fa8958",
        "order": 7,
        "width": 1,
        "height": 1
    },
    {
        "id": "f4cafd8e.2fc58",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "bdf4ab4f.fa8958",
        "order": 9,
        "width": 1,
        "height": 1
    },
    {
        "id": "217cc961.603ce6",
        "type": "persist-store",
        "filename": "/home/pi/.node-red/projects/hydro/persistence.json",
        "interval": "60"
    },
    {
        "id": "c6be6d42.f806a",
        "type": "ui_group",
        "name": "Seed tray - Environment control",
        "tab": "352c089f.6b44d8",
        "order": 8,
        "disp": true,
        "width": 7,
        "collapse": false
    },
    {
        "id": "45199dde.854f64",
        "type": "ui_group",
        "name": "Seed tray - Light",
        "tab": "352c089f.6b44d8",
        "order": 9,
        "disp": true,
        "width": 9,
        "collapse": false
    },
    {
        "id": "d7901f40.2659d",
        "type": "ui_tab",
        "name": "Charts",
        "icon": "dashboard",
        "order": 2
    },
    {
        "id": "52fad04b.9716b",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "1c37dc0b.ce28e4",
        "order": 5,
        "width": 5,
        "height": 1
    },
    {
        "id": "accbadb5.9eb1a",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "1c37dc0b.ce28e4",
        "order": 9,
        "width": 5,
        "height": 1
    },
    {
        "id": "f458b214.df09",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "8a9b009f.1b35d",
        "order": 5,
        "width": 2,
        "height": 1
    },
    {
        "id": "bff9ea7.cd5b418",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "72b67add.961f74",
        "order": 2,
        "width": 1,
        "height": 1
    },
    {
        "id": "1a6ee5cc.78fe6a",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "8d4aab9b.4d6328",
        "order": 3,
        "width": 1,
        "height": 1
    },
    {
        "id": "1c175c1b.f04814",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "8d4aab9b.4d6328",
        "order": 6,
        "width": 1,
        "height": 1
    },
    {
        "id": "52cd32aa.16434c",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "8d4aab9b.4d6328",
        "order": 9,
        "width": 1,
        "height": 1
    },
    {
        "id": "2cc3a99.2a1a656",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "8d4aab9b.4d6328",
        "order": 11,
        "width": 1,
        "height": 1
    },
    {
        "id": "4514d02a.e6cb6",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "45199dde.854f64",
        "order": 8,
        "width": 4,
        "height": 1
    },
    {
        "id": "a27203cb.b323",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "45199dde.854f64",
        "order": 10,
        "width": 2,
        "height": 1
    },
    {
        "id": "ff4c8430.54fc08",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "45199dde.854f64",
        "order": 11,
        "width": 4,
        "height": 1
    },
    {
        "id": "9b8f575a.b741a8",
        "type": "ui_group",
        "name": "Stat",
        "tab": "8eef0cc0.5b1bf",
        "order": 2,
        "disp": false,
        "width": "6"
    },
    {
        "id": "f0089344.b8ed1",
        "type": "ui_group",
        "name": "Ora",
        "tab": "8eef0cc0.5b1bf",
        "order": 2,
        "disp": false,
        "width": "6"
    },
    {
        "id": "f1a9197e.2dfc88",
        "type": "ui_group",
        "name": "Stat1",
        "tab": "8eef0cc0.5b1bf",
        "order": 1,
        "disp": false,
        "width": "6"
    },
    {
        "id": "f59caa4c.0eb048",
        "type": "ui_group",
        "name": "ON OFF scheduler",
        "tab": "8eef0cc0.5b1bf",
        "order": 4,
        "disp": false,
        "width": "6"
    },
    {
        "id": "236e90ca.4e1d",
        "type": "ui_group",
        "name": "Stat2",
        "tab": "8eef0cc0.5b1bf",
        "order": 5,
        "disp": false,
        "width": "6"
    },
    {
        "id": "8eef0cc0.5b1bf",
        "type": "ui_tab",
        "name": "Schedulers",
        "icon": "dashboard"
    },
    {
        "id": "e30bc267.9a60e",
        "type": "mqtt in",
        "z": "1d22c714.e50369",
        "name": "",
        "topic": "hydro/t/seed_tray",
        "qos": "0",
        "datatype": "auto",
        "broker": "a0e631b8.d383b",
        "x": 200,
        "y": 640,
        "wires": [
            [
                "67398353.3f850c"
            ]
        ]
    },
    {
        "id": "67398353.3f850c",
        "type": "json",
        "z": "1d22c714.e50369",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 350,
        "y": 640,
        "wires": [
            [
                "4fa1702.8b2e49"
            ]
        ]
    },
    {
        "id": "4fa1702.8b2e49",
        "type": "function",
        "z": "1d22c714.e50369",
        "name": "Parse telemetry JSON",
        "func": "\n\nvar waterQualityMsg = { \n    payload: msg.payload.s.water.ppm\n};\n\nvar waterTempMsg = { \n    payload: msg.payload.s.water.temp\n};\n\nvar waterPhMsg = { \n    payload: msg.payload.s.water.ph\n};\n\nvar waterLevelMsg = { \n    payload: msg.payload.s.water.level\n};\n\nvar luminosityMsg = { \n    payload: msg.payload.s.lux\n};\n\n\nreturn [\n    waterQualityMsg, \n    luminosityMsg, \n    waterTempMsg,\n    waterPhMsg,\n    waterLevelMsg\n];",
        "outputs": 5,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 420,
        "y": 820,
        "wires": [
            [
                "6a5ac7a1.e350c8",
                "39bf6628.85f8ba",
                "b2d124cc.ae5b18",
                "b74e71c3.dd092"
            ],
            [
                "b7f7abe3.8afe58",
                "cffdb1e7.15d13",
                "ed698194.f939d"
            ],
            [
                "f9ece608.ba06e8",
                "60f91bf2.98dd04",
                "ddf60a00.0b8158"
            ],
            [
                "e3814403.711458",
                "7d66ede7.acf094",
                "84888512.5d3ad8",
                "58d46bc7.965d04"
            ],
            [
                "b1c0fbbf.8e9c58",
                "ce4f2657.0c3588",
                "b8023ba0.969078",
                "7116d9ef.642a58"
            ]
        ]
    },
    {
        "id": "cd880df.29724f",
        "type": "inject",
        "z": "1d22c714.e50369",
        "d": true,
        "name": "DEBUG - Sample telemetry JSON",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{\"seed_tray\":{\"water_quality\":151.9146},\"room\":{\"temperature\":21.1,\"humidity\":46}}",
        "payloadType": "json",
        "x": 240,
        "y": 580,
        "wires": [
            [
                "67398353.3f850c"
            ]
        ]
    },
    {
        "id": "acca3832.810b88",
        "type": "mqtt out",
        "z": "87cb301d.9893c",
        "name": "Lamp",
        "topic": "hydro/lamp/switch",
        "qos": "0",
        "retain": "",
        "broker": "a0e631b8.d383b",
        "x": 770,
        "y": 180,
        "wires": []
    },
    {
        "id": "3e247b14.95d3a4",
        "type": "switch",
        "z": "5127740.f28848c",
        "name": "Mean PH greater than 6.5 or less than 5.5",
        "property": "payload[0].mean",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gt",
                "v": "maxPH",
                "vt": "global"
            },
            {
                "t": "lt",
                "v": "minPH",
                "vt": "global"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 540,
        "y": 200,
        "wires": [
            [
                "8fd06c84.9d955"
            ],
            [
                "f76a168.49897e8"
            ]
        ]
    },
    {
        "id": "8fd06c84.9d955",
        "type": "function",
        "z": "5127740.f28848c",
        "name": "Pass message",
        "func": "msg.payload = \"PH too high\"\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 820,
        "y": 164,
        "wires": [
            [
                "f3e2c3ad.8ebb2"
            ]
        ]
    },
    {
        "id": "e88e5d3f.13895",
        "type": "delay",
        "z": "1d22c714.e50369",
        "name": "",
        "pauseType": "delay",
        "timeout": "2",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 840,
        "y": 1480,
        "wires": [
            [
                "c2314fab.6c8af"
            ]
        ]
    },
    {
        "id": "55893afd.1a9904",
        "type": "delay",
        "z": "1d22c714.e50369",
        "name": "",
        "pauseType": "delay",
        "timeout": "2",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 840,
        "y": 1620,
        "wires": [
            [
                "d8035b86.a6d9f8"
            ]
        ]
    },
    {
        "id": "39bf6628.85f8ba",
        "type": "delay",
        "z": "1d22c714.e50369",
        "name": "",
        "pauseType": "delay",
        "timeout": "2",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 780,
        "y": 500,
        "wires": [
            [
                "7fe995e5.477afc",
                "f8fee95.2171618"
            ]
        ]
    },
    {
        "id": "a2db89f8.423ad8",
        "type": "mqtt in",
        "z": "1d22c714.e50369",
        "name": "",
        "topic": "hydro/lamp/s",
        "qos": "0",
        "datatype": "auto",
        "broker": "a0e631b8.d383b",
        "x": 210,
        "y": 1960,
        "wires": [
            [
                "54666026.3c8da"
            ]
        ]
    },
    {
        "id": "62bc488f.b3dd18",
        "type": "mqtt in",
        "z": "1d22c714.e50369",
        "name": "",
        "topic": "hydro/t/room",
        "qos": "0",
        "datatype": "auto",
        "broker": "a0e631b8.d383b",
        "x": 190,
        "y": 1480,
        "wires": [
            [
                "7023be29.a8b"
            ]
        ]
    },
    {
        "id": "7023be29.a8b",
        "type": "json",
        "z": "1d22c714.e50369",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 390,
        "y": 1480,
        "wires": [
            [
                "1e6d501a.c6f28"
            ]
        ]
    },
    {
        "id": "1e6d501a.c6f28",
        "type": "function",
        "z": "1d22c714.e50369",
        "name": "Parse telemetry JSON",
        "func": "\nvar roomTemperatureMsg =  { \n        payload: msg.payload.r.t \n};\n    \nvar roomHumidityMsg = { \n    payload: msg.payload.r.h\n}; \n\nreturn [\n    roomTemperatureMsg, \n    roomHumidityMsg\n];",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 600,
        "y": 1480,
        "wires": [
            [
                "b5c12285.51ca3",
                "e88e5d3f.13895",
                "9b1656b1.099d08"
            ],
            [
                "f3b265b2.271218",
                "55893afd.1a9904",
                "a2c963c.a4756a"
            ]
        ]
    },
    {
        "id": "60f91bf2.98dd04",
        "type": "delay",
        "z": "1d22c714.e50369",
        "name": "",
        "pauseType": "delay",
        "timeout": "2",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 760,
        "y": 860,
        "wires": [
            [
                "61e95af8.591824",
                "a34db445.a149b8"
            ]
        ]
    },
    {
        "id": "85c1ae45.14716",
        "type": "comment",
        "z": "1d22c714.e50369",
        "name": "OpenWeatherMap One Call API for Weather and Forecast",
        "info": "",
        "x": 550,
        "y": 80,
        "wires": []
    },
    {
        "id": "c8db48f7.af9608",
        "type": "http request",
        "z": "1d22c714.e50369",
        "name": "Get OWM data",
        "method": "GET",
        "ret": "obj",
        "paytoqs": "query",
        "url": "https://api.openweathermap.org/data/2.5/onecall",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "",
        "x": 760,
        "y": 200,
        "wires": [
            [
                "fe79ff8b.aa786",
                "6c1d8e8.c6bf77"
            ]
        ]
    },
    {
        "id": "f376d3a0.9a725",
        "type": "inject",
        "z": "1d22c714.e50369",
        "name": "Trigger",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "3000",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "true",
        "payloadType": "bool",
        "x": 400,
        "y": 140,
        "wires": [
            [
                "a887c10.0424b4"
            ]
        ]
    },
    {
        "id": "fe79ff8b.aa786",
        "type": "function",
        "z": "1d22c714.e50369",
        "name": "Format current data",
        "func": "var icon = {};\n\nvar units=flow.get('units');\nif (units===undefined)\n{\n  units=\"imperial\";\n}\n\nfunction timeConvert(UNIX_timestamp, offset){\n  var a = new Date(UNIX_timestamp * 1000 + offset*1000);\n  var hour = a.getHours();\n  var suffix = \" am\";\n  if (hour >= 12) {\n    hour = hour - 12;\n    suffix = \" pm\";\n  }\n  if (hour === 0) {\n    hour = 12;\n  }\n  var min = a.getMinutes();\n  if (min < 10) {min = \"0\" + min;}\n  return hour + ':' + min + suffix;\n}\n\nvar degreesToCardinal = function(deg){\nif (deg>11.25 && deg<=33.75){\nreturn \"NNE\";\n  }else if (deg>33.75 && deg<56.25){\nreturn \"NE\";\n  }else if (deg>56.25 && deg<78.75){\nreturn \"ENE\";\n  }else if (deg>78.75 && deg<101.25){\nreturn \"E\";\n  }else if (deg>101.25 && deg<123.75){\nreturn \"ESE\";\n  }else if (deg>123.75 && deg<146.25){\nreturn \"SE\";\n  }else if (deg>146.25 && deg<168.75){\nreturn \"SSE\";\n  }else if (deg>168.75 && deg<191.25){\nreturn \"S\";\n  }else if (deg>191.25 && deg<213.75){\nreturn \"SSW\";\n  }else if (deg>213.75 && deg<236.25){\nreturn \"SW\";\n  }else if (deg>236.25 && deg<258.75){\nreturn \"WSW\";\n  }else if (deg>258.75 && deg<281.25){\nreturn \"W\";\n  }else if (deg>281.25 && deg<303.75){\nreturn \"WNW\";\n  }else if (deg>303.75 && deg<326.25){\nreturn \"NW\";\n  }else if (deg>326.25 && deg<348.75){\nreturn \"NNW\";\n  }else{\nreturn \"N\"; \n  }\n}\n\nif (units == \"imperial\")\n{\n  msg.payload.current.temp = msg.payload.current.temp.toFixed() + ' °F';\n  msg.payload.current.wind_speed = msg.payload.current.wind_speed.toFixed() + ' mph';\n}\nelse // metric units\n{\n  msg.payload.current.temp = msg.payload.current.temp.toFixed(1) + ' °C';\n  msg.payload.current.wind_speed = msg.payload.current.wind_speed.toFixed(1) + ' m/s';\n}\n\nmsg.payload.current.wind_cardinal = degreesToCardinal(msg.payload.current.wind_deg);\nmsg.payload.current.sunrise = timeConvert(msg.payload.current.sunrise, msg.payload.timezone_offset);\nmsg.payload.current.sunset = timeConvert(msg.payload.current.sunset, msg.payload.timezone_offset);\n\nvar iconString = 'wi-owm-' + msg.payload.current.weather[0].icon + ' wi-4x';\nicon = {\n    ui_control: {\n        icon: iconString\n    }\n}; \n\nreturn [msg, icon];",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 1000,
        "y": 200,
        "wires": [
            [
                "ebeb7e6d.61e6c",
                "c9cadf3c.4dd91",
                "75f934f.744b2cc",
                "a77336d4.24c878",
                "ffd2dd.8b18ad2",
                "f9da79c2.9a6128"
            ],
            [
                "509eb66d.0f6d88"
            ]
        ]
    },
    {
        "id": "a887c10.0424b4",
        "type": "change",
        "z": "1d22c714.e50369",
        "name": "Set location, appid, units",
        "rules": [
            {
                "t": "delete",
                "p": "payload",
                "pt": "msg"
            },
            {
                "t": "set",
                "p": "payload.lat",
                "pt": "msg",
                "to": "35.64",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload.lon",
                "pt": "msg",
                "to": "139.75",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload.appid",
                "pt": "msg",
                "to": "15d881fdb1d9153fb4f7a70b1213113b",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload.units",
                "pt": "msg",
                "to": "metric",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "units",
                "pt": "flow",
                "to": "payload.units",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 630,
        "y": 140,
        "wires": [
            [
                "c8db48f7.af9608"
            ]
        ]
    },
    {
        "id": "45293d1e.aedc04",
        "type": "link out",
        "z": "1d22c714.e50369",
        "name": "Refresh",
        "links": [
            "b8c07479.ab99c8"
        ],
        "x": 1395,
        "y": 300,
        "wires": []
    },
    {
        "id": "b8c07479.ab99c8",
        "type": "link in",
        "z": "1d22c714.e50369",
        "name": "",
        "links": [
            "45293d1e.aedc04"
        ],
        "x": 435,
        "y": 180,
        "wires": [
            [
                "a887c10.0424b4"
            ]
        ]
    },
    {
        "id": "58c9bab9.be3fc4",
        "type": "function",
        "z": "1d22c714.e50369",
        "name": "Parse telemetry JSON",
        "func": "\nvar newMsg =  { \n        payload: new Date(msg.payload[0].time)\n};\nreturn newMsg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 1200,
        "y": 1620,
        "wires": [
            [
                "65b18579.9e97ec"
            ]
        ]
    },
    {
        "id": "5914ecc9.808654",
        "type": "function",
        "z": "1d22c714.e50369",
        "name": "Parse telemetry JSON",
        "func": "\nvar newMsg =  { \n        payload: new Date(msg.payload[0].time)\n};\nreturn newMsg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 1200,
        "y": 1480,
        "wires": [
            [
                "1c83a03b.a169c"
            ]
        ]
    },
    {
        "id": "8b39391d.356ce8",
        "type": "function",
        "z": "1d22c714.e50369",
        "name": "",
        "func": "\n var series =[\"Water quality\", \"Water temperature\", \"Luminosity\", \"Water PH\"];\n var labels = [\"Water quality\", \"Water temperature\", \"Luminosity\", \"Water PH\"];\n var data = [];\n var dataWaterQuality = [];\n var dataWaterPH = [];\n var dataWaterTemperature = [];\n var dataLuminosity = [];\n\n var i, len, string;\n\n for (i = 0, len = msg.payload.waterTemperature.length, string = \"\"; i < len; i++) {\n  dataWaterTemperature.push({\n        \"x\":Date.parse(msg.payload.waterTemperature[i].time), \n        \"y\":Number(msg.payload.waterTemperature[i].value)});\n  }\n\n for (i = 0, len = msg.payload.waterQuality.length, string = \"\"; i < len; i++) {\n    dataWaterQuality.push({\n        \"x\":Date.parse(msg.payload.waterQuality[i].time), \n        \"y\":Number(msg.payload.waterQuality[i].value)});\n }\n \n for (i = 0, len = msg.payload.luminosity.length, string = \"\"; i < len; i++) {\n    dataLuminosity.push({\n        \"x\":Date.parse(msg.payload.luminosity[i].time), \n        \"y\":Number(msg.payload.luminosity[i].value)});\n }\n \n for (i = 0, len = msg.payload.waterPH.length, string = \"\"; i < len; i++) {\n    dataWaterPH.push({\n        \"x\":Date.parse(msg.payload.waterPH[i].time), \n        \"y\":Number(msg.payload.waterPH[i].value)});\n }\n     \n\n data = [dataWaterQuality, dataWaterTemperature,\n    dataLuminosity, dataWaterPH];\n    \n msg.payload = [{series, data, labels}];\n\n return msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 1600,
        "y": 800,
        "wires": [
            [
                "ad68634.aaabaa"
            ]
        ]
    },
    {
        "id": "fff065af.0a0958",
        "type": "change",
        "z": "1d22c714.e50369",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "origin",
                "pt": "msg",
                "to": "waterQuality",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1180,
        "y": 540,
        "wires": [
            [
                "abe678a7.9a28b8"
            ]
        ]
    },
    {
        "id": "7b566b7.097d094",
        "type": "change",
        "z": "1d22c714.e50369",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "origin",
                "pt": "msg",
                "to": "waterTemperature",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1160,
        "y": 900,
        "wires": [
            [
                "abe678a7.9a28b8"
            ]
        ]
    },
    {
        "id": "abe678a7.9a28b8",
        "type": "join",
        "z": "1d22c714.e50369",
        "name": "",
        "mode": "custom",
        "build": "object",
        "property": "payload",
        "propertyType": "msg",
        "key": "origin",
        "joiner": "message",
        "joinerType": "str",
        "accumulate": false,
        "timeout": "",
        "count": "4",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceFixup": "",
        "x": 1470,
        "y": 800,
        "wires": [
            [
                "8b39391d.356ce8"
            ]
        ]
    },
    {
        "id": "3e5edd24.dccb82",
        "type": "function",
        "z": "1d22c714.e50369",
        "name": "Parse telemetry JSON",
        "func": "\nvar newMsg =  { \n        payload: new Date(msg.payload[0].time)\n};\nreturn newMsg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 1180,
        "y": 860,
        "wires": [
            [
                "ad8e7270.bfabd"
            ]
        ]
    },
    {
        "id": "eb66256c.111fa8",
        "type": "function",
        "z": "1d22c714.e50369",
        "name": "Parse telemetry JSON",
        "func": "\nvar newMsg =  { \n        payload: new Date(msg.payload[0].time)\n};\nreturn newMsg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 1200,
        "y": 500,
        "wires": [
            [
                "383c0ad2.b2e656"
            ]
        ]
    },
    {
        "id": "b9dd843.3247178",
        "type": "delay",
        "z": "87cb301d.9893c",
        "name": "",
        "pauseType": "delayv",
        "timeout": "20",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 1481,
        "y": 480,
        "wires": [
            [
                "25335612.5b58da"
            ]
        ]
    },
    {
        "id": "e6b06459.aad598",
        "type": "mqtt out",
        "z": "87cb301d.9893c",
        "name": "Water spray",
        "topic": "hydro/water_spray/switch",
        "qos": "0",
        "retain": "",
        "broker": "a0e631b8.d383b",
        "x": 831,
        "y": 420,
        "wires": []
    },
    {
        "id": "a1ae6930.2b69c8",
        "type": "mqtt in",
        "z": "1d22c714.e50369",
        "name": "",
        "topic": "hydro/water_spray/s",
        "qos": "0",
        "datatype": "auto",
        "broker": "a0e631b8.d383b",
        "x": 208,
        "y": 1640,
        "wires": [
            [
                "d0f89a7b.d9a8f8"
            ]
        ]
    },
    {
        "id": "8c5d6ffa.8aeae",
        "type": "link out",
        "z": "87cb301d.9893c",
        "name": "",
        "links": [],
        "x": -35,
        "y": 60,
        "wires": []
    },
    {
        "id": "25335612.5b58da",
        "type": "change",
        "z": "87cb301d.9893c",
        "name": "Switch to off",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "false",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1631,
        "y": 480,
        "wires": [
            [
                "c1e51a25.bcd2f8"
            ]
        ]
    },
    {
        "id": "dec1467a.516188",
        "type": "switch",
        "z": "87cb301d.9893c",
        "name": "When water spray on",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 861,
        "y": 480,
        "wires": [
            [
                "57e4ad43.c33774"
            ]
        ]
    },
    {
        "id": "e78bf6ed.43bf08",
        "type": "inject",
        "z": "1d22c714.e50369",
        "name": "",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "600",
        "crontab": "",
        "once": true,
        "onceDelay": "0.2",
        "topic": "",
        "payload": "1",
        "payloadType": "num",
        "x": 190,
        "y": 1780,
        "wires": [
            [
                "134f40ec.1ec4bf"
            ]
        ]
    },
    {
        "id": "cffdb1e7.15d13",
        "type": "delay",
        "z": "1d22c714.e50369",
        "name": "",
        "pauseType": "delay",
        "timeout": "2",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 780,
        "y": 680,
        "wires": [
            [
                "5e814313.84529c",
                "afc9c5e2.a75b78"
            ]
        ]
    },
    {
        "id": "517995d5.866e6c",
        "type": "change",
        "z": "1d22c714.e50369",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "origin",
                "pt": "msg",
                "to": "luminosity",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1180,
        "y": 720,
        "wires": [
            [
                "abe678a7.9a28b8"
            ]
        ]
    },
    {
        "id": "5a973813.655e68",
        "type": "function",
        "z": "1d22c714.e50369",
        "name": "Parse telemetry JSON",
        "func": "\nvar newMsg =  { \n        payload: new Date(msg.payload[0].time)\n};\nreturn newMsg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 1200,
        "y": 680,
        "wires": [
            [
                "cb675a7c.a85308"
            ]
        ]
    },
    {
        "id": "7d66ede7.acf094",
        "type": "delay",
        "z": "1d22c714.e50369",
        "name": "",
        "pauseType": "delay",
        "timeout": "2",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 760,
        "y": 1080,
        "wires": [
            [
                "4594e62e.1bff58",
                "42b0c0f5.42fdf"
            ]
        ]
    },
    {
        "id": "a12ec6c.7faa138",
        "type": "change",
        "z": "1d22c714.e50369",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "origin",
                "pt": "msg",
                "to": "waterPH",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1160,
        "y": 1120,
        "wires": [
            [
                "abe678a7.9a28b8"
            ]
        ]
    },
    {
        "id": "9442afba.2d0c3",
        "type": "function",
        "z": "1d22c714.e50369",
        "name": "Parse telemetry JSON",
        "func": "\nvar newMsg =  { \n        payload: new Date(msg.payload[0].time)\n};\nreturn newMsg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 1180,
        "y": 1080,
        "wires": [
            [
                "1aca970a.1a6d09"
            ]
        ]
    },
    {
        "id": "134f40ec.1ec4bf",
        "type": "camerapi-takephoto",
        "z": "1d22c714.e50369",
        "filemode": "1",
        "filename": "photo1.JPEG",
        "filedefpath": "0",
        "filepath": "~/.node-red/projects/hydro/ui-media/",
        "fileformat": "jpeg",
        "resolution": "4",
        "rotation": "0",
        "fliph": "0",
        "flipv": "0",
        "brightness": "50",
        "contrast": "0",
        "sharpness": "0",
        "quality": "80",
        "imageeffect": "none",
        "exposuremode": "night",
        "iso": "0",
        "agcwait": "1.0",
        "led": "0",
        "awb": "auto",
        "name": "Take Photo",
        "x": 360,
        "y": 1780,
        "wires": [
            [
                "ec42ca0e.6c9dd8"
            ]
        ]
    },
    {
        "id": "6a5ac7a1.e350c8",
        "type": "influxdb out",
        "z": "1d22c714.e50369",
        "influxdb": "8193652c.e6bda8",
        "name": "",
        "measurement": "water_quality",
        "precision": "",
        "retentionPolicy": "",
        "database": "database",
        "precisionV18FluxV20": "ms",
        "retentionPolicyV18Flux": "",
        "org": "organisation",
        "bucket": "bucket",
        "x": 880,
        "y": 460,
        "wires": []
    },
    {
        "id": "b5c12285.51ca3",
        "type": "influxdb out",
        "z": "1d22c714.e50369",
        "influxdb": "8193652c.e6bda8",
        "name": "",
        "measurement": "room_temperature",
        "precision": "",
        "retentionPolicy": "",
        "database": "database",
        "precisionV18FluxV20": "ms",
        "retentionPolicyV18Flux": "",
        "org": "organisation",
        "bucket": "bucket",
        "x": 960,
        "y": 1440,
        "wires": []
    },
    {
        "id": "f3b265b2.271218",
        "type": "influxdb out",
        "z": "1d22c714.e50369",
        "influxdb": "8193652c.e6bda8",
        "name": "",
        "measurement": "room_humidity",
        "precision": "",
        "retentionPolicy": "",
        "database": "database",
        "precisionV18FluxV20": "ms",
        "retentionPolicyV18Flux": "",
        "org": "organisation",
        "bucket": "bucket",
        "x": 950,
        "y": 1580,
        "wires": []
    },
    {
        "id": "b7f7abe3.8afe58",
        "type": "influxdb out",
        "z": "1d22c714.e50369",
        "influxdb": "8193652c.e6bda8",
        "name": "",
        "measurement": "luminosity",
        "precision": "",
        "retentionPolicy": "",
        "database": "database",
        "precisionV18FluxV20": "ms",
        "retentionPolicyV18Flux": "",
        "org": "organisation",
        "bucket": "bucket",
        "x": 870,
        "y": 640,
        "wires": []
    },
    {
        "id": "f9ece608.ba06e8",
        "type": "influxdb out",
        "z": "1d22c714.e50369",
        "influxdb": "8193652c.e6bda8",
        "name": "",
        "measurement": "water_temperature",
        "precision": "",
        "retentionPolicy": "",
        "database": "database",
        "precisionV18FluxV20": "ms",
        "retentionPolicyV18Flux": "",
        "org": "organisation",
        "bucket": "bucket",
        "x": 880,
        "y": 820,
        "wires": []
    },
    {
        "id": "e3814403.711458",
        "type": "influxdb out",
        "z": "1d22c714.e50369",
        "influxdb": "8193652c.e6bda8",
        "name": "",
        "measurement": "water_ph",
        "precision": "",
        "retentionPolicy": "",
        "database": "database",
        "precisionV18FluxV20": "ms",
        "retentionPolicyV18Flux": "",
        "org": "organisation",
        "bucket": "bucket",
        "x": 850,
        "y": 1040,
        "wires": []
    },
    {
        "id": "1b07e4d1.7c4d9b",
        "type": "influxdb in",
        "z": "5127740.f28848c",
        "influxdb": "8193652c.e6bda8",
        "name": "Mean water PH over last 20min",
        "query": "SELECT mean(value) FROM water_ph WHERE time >= now() - 20m",
        "rawOutput": false,
        "precision": "",
        "retentionPolicy": "",
        "org": "organisation",
        "x": 210,
        "y": 200,
        "wires": [
            [
                "3e247b14.95d3a4"
            ]
        ]
    },
    {
        "id": "c2314fab.6c8af",
        "type": "influxdb in",
        "z": "1d22c714.e50369",
        "influxdb": "8193652c.e6bda8",
        "name": "Select last entry",
        "query": "SELECT * FROM room_temperature GROUP BY * ORDER BY DESC LIMIT 1",
        "rawOutput": false,
        "precision": "",
        "retentionPolicy": "",
        "org": "organisation",
        "x": 1000,
        "y": 1480,
        "wires": [
            [
                "5914ecc9.808654"
            ]
        ]
    },
    {
        "id": "d8035b86.a6d9f8",
        "type": "influxdb in",
        "z": "1d22c714.e50369",
        "influxdb": "8193652c.e6bda8",
        "name": "Select last entry",
        "query": "SELECT * FROM room_humidity GROUP BY * ORDER BY DESC LIMIT 1",
        "rawOutput": false,
        "precision": "",
        "retentionPolicy": "",
        "org": "organisation",
        "x": 1000,
        "y": 1620,
        "wires": [
            [
                "58c9bab9.be3fc4"
            ]
        ]
    },
    {
        "id": "7fe995e5.477afc",
        "type": "influxdb in",
        "z": "1d22c714.e50369",
        "influxdb": "8193652c.e6bda8",
        "name": "Select last entry",
        "query": "SELECT * FROM water_quality GROUP BY * ORDER BY DESC LIMIT 1",
        "rawOutput": false,
        "precision": "",
        "retentionPolicy": "",
        "org": "organisation",
        "x": 940,
        "y": 500,
        "wires": [
            [
                "eb66256c.111fa8"
            ]
        ]
    },
    {
        "id": "61e95af8.591824",
        "type": "influxdb in",
        "z": "1d22c714.e50369",
        "influxdb": "8193652c.e6bda8",
        "name": "Select last entry",
        "query": "SELECT * FROM water_temperature GROUP BY * ORDER BY DESC LIMIT 1",
        "rawOutput": false,
        "precision": "",
        "retentionPolicy": "",
        "org": "organisation",
        "x": 920,
        "y": 860,
        "wires": [
            [
                "3e5edd24.dccb82"
            ]
        ]
    },
    {
        "id": "f8fee95.2171618",
        "type": "influxdb in",
        "z": "1d22c714.e50369",
        "influxdb": "8193652c.e6bda8",
        "name": "Select past 24 hours",
        "query": "SELECT * FROM water_quality  WHERE time >= now() - 24h ORDER BY time DESC",
        "rawOutput": false,
        "precision": "",
        "retentionPolicy": "",
        "org": "organisation",
        "x": 960,
        "y": 540,
        "wires": [
            [
                "fff065af.0a0958"
            ]
        ]
    },
    {
        "id": "a34db445.a149b8",
        "type": "influxdb in",
        "z": "1d22c714.e50369",
        "influxdb": "8193652c.e6bda8",
        "name": "Select past 24 hours",
        "query": "SELECT * FROM water_temperature  WHERE time >= now() - 24h ORDER BY time DESC",
        "rawOutput": false,
        "precision": "",
        "retentionPolicy": "",
        "org": "organisation",
        "x": 940,
        "y": 900,
        "wires": [
            [
                "7b566b7.097d094"
            ]
        ]
    },
    {
        "id": "5e814313.84529c",
        "type": "influxdb in",
        "z": "1d22c714.e50369",
        "influxdb": "8193652c.e6bda8",
        "name": "Select past 24 hours",
        "query": "SELECT * FROM luminosity  WHERE time >= now() - 24h ORDER BY time DESC",
        "rawOutput": false,
        "precision": "",
        "retentionPolicy": "",
        "org": "organisation",
        "x": 960,
        "y": 720,
        "wires": [
            [
                "517995d5.866e6c"
            ]
        ]
    },
    {
        "id": "afc9c5e2.a75b78",
        "type": "influxdb in",
        "z": "1d22c714.e50369",
        "influxdb": "8193652c.e6bda8",
        "name": "Select last entry",
        "query": "SELECT * FROM luminosity GROUP BY * ORDER BY DESC LIMIT 1",
        "rawOutput": false,
        "precision": "",
        "retentionPolicy": "",
        "org": "organisation",
        "x": 940,
        "y": 680,
        "wires": [
            [
                "5a973813.655e68"
            ]
        ]
    },
    {
        "id": "4594e62e.1bff58",
        "type": "influxdb in",
        "z": "1d22c714.e50369",
        "influxdb": "8193652c.e6bda8",
        "name": "Select last entry",
        "query": "SELECT * FROM water_ph GROUP BY * ORDER BY DESC LIMIT 1",
        "rawOutput": false,
        "precision": "",
        "retentionPolicy": "",
        "org": "organisation",
        "x": 920,
        "y": 1080,
        "wires": [
            [
                "9442afba.2d0c3"
            ]
        ]
    },
    {
        "id": "42b0c0f5.42fdf",
        "type": "influxdb in",
        "z": "1d22c714.e50369",
        "influxdb": "8193652c.e6bda8",
        "name": "Select past 24 hours",
        "query": "SELECT * FROM water_ph WHERE time >= now() - 24h ORDER BY time DESC",
        "rawOutput": false,
        "precision": "",
        "retentionPolicy": "",
        "org": "organisation",
        "x": 940,
        "y": 1120,
        "wires": [
            [
                "a12ec6c.7faa138"
            ]
        ]
    },
    {
        "id": "ed698194.f939d",
        "type": "ui_artlessgauge",
        "z": "1d22c714.e50369",
        "group": "45199dde.854f64",
        "order": 1,
        "width": 4,
        "height": 1,
        "name": "Luminosity",
        "icon": "fa-fire",
        "label": "",
        "unit": "Lux",
        "layout": "linear",
        "decimals": 0,
        "differential": false,
        "minmax": true,
        "colorTrack": "#555555",
        "style": "",
        "colorFromTheme": true,
        "property": "payload",
        "secondary": "secondary",
        "inline": false,
        "sectors": [
            {
                "val": 0,
                "col": "#337f24",
                "t": "min",
                "dot": 0
            },
            {
                "val": 15000,
                "col": "#337f24",
                "t": "max",
                "dot": 0
            }
        ],
        "lineWidth": "5",
        "bgcolorFromTheme": true,
        "diffCenter": "",
        "x": 790,
        "y": 600,
        "wires": []
    },
    {
        "id": "ddf60a00.0b8158",
        "type": "ui_artlessgauge",
        "z": "1d22c714.e50369",
        "group": "65d119b5.66cb78",
        "order": 1,
        "width": 9,
        "height": 1,
        "name": "Water temperature",
        "icon": "fa-thermometer",
        "label": "Water temperature",
        "unit": " °C",
        "layout": "linear",
        "decimals": 0,
        "differential": false,
        "minmax": true,
        "colorTrack": "#555555",
        "style": "",
        "colorFromTheme": true,
        "property": "payload",
        "secondary": "secondary",
        "inline": true,
        "sectors": [
            {
                "val": 0,
                "col": "#ff9900",
                "t": "min",
                "dot": 0
            },
            {
                "val": 5,
                "col": "#cccc00",
                "t": "sec",
                "dot": 0
            },
            {
                "val": 15,
                "col": "#337f24",
                "t": "sec",
                "dot": 0
            },
            {
                "val": 25,
                "col": "#d7771d",
                "t": "sec",
                "dot": 0
            },
            {
                "val": 40,
                "col": "#d7771d",
                "t": "max",
                "dot": 0
            }
        ],
        "lineWidth": "5",
        "bgcolorFromTheme": true,
        "diffCenter": "",
        "x": 790,
        "y": 780,
        "wires": []
    },
    {
        "id": "63de4a5e.7c19a4",
        "type": "ui_artlessgauge",
        "z": "1d22c714.e50369",
        "group": "65d119b5.66cb78",
        "order": 7,
        "width": 4,
        "height": 4,
        "name": "Water Quality",
        "icon": "fa-filter",
        "label": "Water quality",
        "unit": "PPM",
        "layout": "radial",
        "decimals": 0,
        "differential": true,
        "minmax": true,
        "colorTrack": "#555555",
        "style": "",
        "colorFromTheme": true,
        "property": "payload",
        "secondary": "secondary",
        "inline": true,
        "sectors": [
            {
                "val": 0,
                "col": "#ff6666",
                "t": "min",
                "dot": 0
            },
            {
                "val": 2500,
                "col": "#ff6666",
                "t": "max",
                "dot": 0
            }
        ],
        "lineWidth": "3",
        "bgcolorFromTheme": true,
        "diffCenter": "",
        "x": 1040,
        "y": 420,
        "wires": []
    },
    {
        "id": "9b1656b1.099d08",
        "type": "ui_artlessgauge",
        "z": "1d22c714.e50369",
        "group": "8a9b009f.1b35d",
        "order": 1,
        "width": 0,
        "height": 0,
        "name": "Room temperature DHT11",
        "icon": "fa-thermometer-full",
        "label": "Temperature",
        "unit": " °C",
        "layout": "linear",
        "decimals": 0,
        "differential": false,
        "minmax": true,
        "colorTrack": "#555555",
        "style": "",
        "colorFromTheme": true,
        "property": "payload",
        "secondary": "secondary",
        "inline": true,
        "sectors": [
            {
                "val": 0,
                "col": "#ff3333",
                "t": "min",
                "dot": 0
            },
            {
                "val": 12,
                "col": "#ff9900",
                "t": "sec",
                "dot": 0
            },
            {
                "val": 18,
                "col": "#337f24",
                "t": "sec",
                "dot": 0
            },
            {
                "val": 30,
                "col": "#ff9900",
                "t": "sec",
                "dot": 0
            },
            {
                "val": 40,
                "col": "#ff9900",
                "t": "max",
                "dot": 0
            }
        ],
        "lineWidth": "5",
        "bgcolorFromTheme": true,
        "diffCenter": "",
        "x": 900,
        "y": 1380,
        "wires": []
    },
    {
        "id": "a2c963c.a4756a",
        "type": "ui_artlessgauge",
        "z": "1d22c714.e50369",
        "group": "8a9b009f.1b35d",
        "order": 2,
        "width": 0,
        "height": 0,
        "name": "Room Humidity DHT11",
        "icon": "fa-tint",
        "label": "Humidity",
        "unit": "%",
        "layout": "linear",
        "decimals": 0,
        "differential": false,
        "minmax": true,
        "colorTrack": "#555555",
        "style": "",
        "colorFromTheme": true,
        "property": "payload",
        "secondary": "secondary",
        "inline": true,
        "sectors": [
            {
                "val": 0,
                "col": "#ff3333",
                "t": "min",
                "dot": 0
            },
            {
                "val": 15,
                "col": "#ff9900",
                "t": "sec",
                "dot": 0
            },
            {
                "val": 25,
                "col": "#337f24",
                "t": "sec",
                "dot": 0
            },
            {
                "val": 55,
                "col": "#ff2300",
                "t": "sec",
                "dot": 0
            },
            {
                "val": 100,
                "col": "#ff2300",
                "t": "max",
                "dot": 0
            }
        ],
        "lineWidth": "5",
        "bgcolorFromTheme": true,
        "diffCenter": "",
        "x": 890,
        "y": 1540,
        "wires": []
    },
    {
        "id": "4d58abb1.177e64",
        "type": "ui_artlessgauge",
        "z": "1d22c714.e50369",
        "group": "65d119b5.66cb78",
        "order": 6,
        "width": 4,
        "height": 4,
        "name": "Water PH",
        "icon": "fa-lemon-o",
        "label": "Water PH",
        "unit": "PH",
        "layout": "radial",
        "decimals": "1",
        "differential": true,
        "minmax": true,
        "colorTrack": "#555555",
        "style": "",
        "colorFromTheme": true,
        "property": "payload",
        "secondary": "secondary",
        "inline": true,
        "sectors": [
            {
                "val": 0,
                "col": "#ff1900",
                "t": "min",
                "dot": 0
            },
            {
                "val": 5,
                "col": "#0ecc00",
                "t": "sec",
                "dot": 5
            },
            {
                "val": 6.5,
                "col": "#fb1900",
                "t": "sec",
                "dot": 2
            },
            {
                "val": 14,
                "col": "#fb1900",
                "t": "max",
                "dot": 5
            }
        ],
        "lineWidth": "3",
        "bgcolorFromTheme": true,
        "diffCenter": "",
        "x": 980,
        "y": 1000,
        "wires": []
    },
    {
        "id": "54666026.3c8da",
        "type": "ui_led",
        "z": "1d22c714.e50369",
        "group": "45199dde.854f64",
        "order": 3,
        "width": 2,
        "height": 1,
        "label": "",
        "labelPlacement": "right",
        "labelAlignment": "right",
        "colorForValue": [
            {
                "color": "red",
                "value": "false",
                "valueType": "str"
            },
            {
                "color": "green",
                "value": "true",
                "valueType": "str"
            }
        ],
        "allowColorForValueInMessage": false,
        "name": "Grow lights",
        "x": 370,
        "y": 1960,
        "wires": []
    },
    {
        "id": "d0f89a7b.d9a8f8",
        "type": "ui_led",
        "z": "1d22c714.e50369",
        "group": "8d4aab9b.4d6328",
        "order": 2,
        "width": 2,
        "height": 1,
        "label": "",
        "labelPlacement": "right",
        "labelAlignment": "right",
        "colorForValue": [
            {
                "color": "red",
                "value": "false",
                "valueType": "str"
            },
            {
                "color": "green",
                "value": "true",
                "valueType": "str"
            }
        ],
        "allowColorForValueInMessage": false,
        "name": "water spray",
        "x": 388,
        "y": 1640,
        "wires": []
    },
    {
        "id": "df864faf.11005",
        "type": "ui_switch",
        "z": "87cb301d.9893c",
        "name": "Grow lights",
        "label": "<span style=\"color:blue\">LED light:</span>",
        "tooltip": "Led",
        "group": "45199dde.854f64",
        "order": 9,
        "width": 3,
        "height": 1,
        "passthru": true,
        "decouple": "false",
        "topic": "hydroponic/lamp",
        "style": "",
        "onvalue": "true",
        "onvalueType": "bool",
        "onicon": "fa-toggle-on fa-2x",
        "oncolor": "orange",
        "offvalue": "false",
        "offvalueType": "bool",
        "officon": "fa-toggle-off  fa-2x",
        "offcolor": "orange",
        "x": 611,
        "y": 180,
        "wires": [
            [
                "acca3832.810b88"
            ]
        ],
        "info": "# Seeds tray light"
    },
    {
        "id": "c1e51a25.bcd2f8",
        "type": "ui_switch",
        "z": "87cb301d.9893c",
        "name": "Water spray",
        "label": "<i class=\"fa fa-tint\"></i> Water spray",
        "tooltip": "",
        "group": "8d4aab9b.4d6328",
        "order": 1,
        "width": 5,
        "height": 1,
        "passthru": true,
        "decouple": "false",
        "topic": "",
        "style": "",
        "onvalue": "true",
        "onvalueType": "bool",
        "onicon": "",
        "oncolor": "",
        "offvalue": "false",
        "offvalueType": "bool",
        "officon": "",
        "offcolor": "",
        "x": 611,
        "y": 420,
        "wires": [
            [
                "dec1467a.516188",
                "e6b06459.aad598"
            ]
        ]
    },
    {
        "id": "509eb66d.0f6d88",
        "type": "ui_button",
        "z": "1d22c714.e50369",
        "name": "IconRefresh",
        "group": "1c37dc0b.ce28e4",
        "order": 1,
        "width": 4,
        "height": 2,
        "passthru": false,
        "label": "",
        "tooltip": "Refresh",
        "color": "",
        "bgcolor": "",
        "icon": "fa-refresh fa-4x",
        "payload": "true",
        "payloadType": "bool",
        "topic": "",
        "x": 1270,
        "y": 300,
        "wires": [
            [
                "45293d1e.aedc04"
            ]
        ]
    },
    {
        "id": "75f934f.744b2cc",
        "type": "ui_text",
        "z": "1d22c714.e50369",
        "group": "1c37dc0b.ce28e4",
        "order": 6,
        "width": 4,
        "height": 1,
        "name": "Description",
        "label": "",
        "format": "{{msg.payload.current.weather[0].description}}",
        "layout": "row-left",
        "x": 1270,
        "y": 100,
        "wires": []
    },
    {
        "id": "c9cadf3c.4dd91",
        "type": "ui_text",
        "z": "1d22c714.e50369",
        "group": "1c37dc0b.ce28e4",
        "order": 3,
        "width": 3,
        "height": 1,
        "name": "Wind",
        "label": "",
        "format": "{{msg.payload.current.wind_speed}}&nbsp;&nbsp;<i class=\"wi wi-darksky-wind\"></i>&nbsp;&nbsp;{{msg.payload.current.wind_cardinal}}",
        "layout": "col-center",
        "x": 1250,
        "y": 180,
        "wires": []
    },
    {
        "id": "a77336d4.24c878",
        "type": "ui_text",
        "z": "1d22c714.e50369",
        "group": "1c37dc0b.ce28e4",
        "order": 4,
        "width": 4,
        "height": 1,
        "name": "SunriseTime",
        "label": "",
        "format": "<i class=\"wi wi-owm-01d\"></i>&nbsp;<i class=\"fa fa-arrow-up\"></i>&nbsp;&nbsp;{{msg.payload.current.sunrise}}",
        "layout": "row-left",
        "x": 1270,
        "y": 220,
        "wires": []
    },
    {
        "id": "ffd2dd.8b18ad2",
        "type": "ui_text",
        "z": "1d22c714.e50369",
        "group": "1c37dc0b.ce28e4",
        "order": 8,
        "width": 4,
        "height": 1,
        "name": "SunsetTime",
        "label": "",
        "format": "<i class=\"wi wi-moon-02\"></i>&nbsp;<i class=\"fa fa-arrow-down\"></i>&nbsp;&nbsp;{{msg.payload.current.sunset}}",
        "layout": "row-left",
        "x": 1270,
        "y": 260,
        "wires": []
    },
    {
        "id": "ebeb7e6d.61e6c",
        "type": "ui_text",
        "z": "1d22c714.e50369",
        "group": "1c37dc0b.ce28e4",
        "order": 7,
        "width": 3,
        "height": 1,
        "name": "Temperature",
        "label": "",
        "format": "<p style=\"font-size: 200%\">{{msg.payload.current.temp}}</p>",
        "layout": "row-left",
        "x": 1270,
        "y": 140,
        "wires": []
    },
    {
        "id": "65b18579.9e97ec",
        "type": "ui_text",
        "z": "1d22c714.e50369",
        "group": "8a9b009f.1b35d",
        "order": 4,
        "width": 4,
        "height": 1,
        "name": "Last refresh - humidity",
        "label": "",
        "format": "<i class=\"fa fa-refresh\" aria-hidden=\"true\">&nbsp; {{ msg.payload | date: 'HH:mm:ss'}}</i> ",
        "layout": "row-center",
        "x": 1420,
        "y": 1620,
        "wires": []
    },
    {
        "id": "1c83a03b.a169c",
        "type": "ui_text",
        "z": "1d22c714.e50369",
        "group": "8a9b009f.1b35d",
        "order": 3,
        "width": 0,
        "height": 0,
        "name": "Last refresh - temp",
        "label": "",
        "format": "<i class=\"fa fa-refresh\" aria-hidden=\"true\">&nbsp; {{ msg.payload | date: 'HH:mm:ss'}}</i> ",
        "layout": "row-center",
        "x": 1410,
        "y": 1480,
        "wires": []
    },
    {
        "id": "ad8e7270.bfabd",
        "type": "ui_text",
        "z": "1d22c714.e50369",
        "d": true,
        "group": "65d119b5.66cb78",
        "order": 4,
        "width": 3,
        "height": 1,
        "name": "Last refresh - water temp",
        "label": "",
        "format": "<i class=\"fa fa-refresh\" aria-hidden=\"true\">&nbsp; {{ msg.payload | date: 'HH:mm:ss'}}</i> ",
        "layout": "row-center",
        "x": 1410,
        "y": 860,
        "wires": []
    },
    {
        "id": "383c0ad2.b2e656",
        "type": "ui_text",
        "z": "1d22c714.e50369",
        "d": true,
        "group": "65d119b5.66cb78",
        "order": 5,
        "width": 4,
        "height": 1,
        "name": "Last refresh - water quality",
        "label": "",
        "format": "<i class=\"fa fa-refresh\" aria-hidden=\"true\">&nbsp; {{ msg.payload | date: 'HH:mm:ss'}}</i> ",
        "layout": "row-center",
        "x": 1440,
        "y": 500,
        "wires": []
    },
    {
        "id": "cb675a7c.a85308",
        "type": "ui_text",
        "z": "1d22c714.e50369",
        "group": "45199dde.854f64",
        "order": 2,
        "width": 3,
        "height": 1,
        "name": "Last refresh - luminosity",
        "label": "",
        "format": "<i class=\"fa fa-refresh\" aria-hidden=\"true\">&nbsp; {{ msg.payload | date: 'HH:mm:ss'}}</i> ",
        "layout": "row-center",
        "x": 1470,
        "y": 680,
        "wires": []
    },
    {
        "id": "1aca970a.1a6d09",
        "type": "ui_text",
        "z": "1d22c714.e50369",
        "d": true,
        "group": "65d119b5.66cb78",
        "order": 3,
        "width": 5,
        "height": 1,
        "name": "Last refresh - water PH",
        "label": "",
        "format": "<i class=\"fa fa-refresh\" aria-hidden=\"true\">&nbsp; {{ msg.payload | date: 'HH:mm:ss'}}</i> ",
        "layout": "row-center",
        "x": 1410,
        "y": 1080,
        "wires": []
    },
    {
        "id": "ad68634.aaabaa",
        "type": "ui_chart",
        "z": "1d22c714.e50369",
        "name": "Seed tray historical value graph",
        "group": "f0e58282.f2736",
        "order": 2,
        "width": 18,
        "height": 8,
        "label": "",
        "chartType": "line",
        "legend": "true",
        "xformat": "HH:mm:ss",
        "interpolate": "bezier",
        "nodata": "",
        "dot": false,
        "ymin": "",
        "ymax": "",
        "removeOlder": 1,
        "removeOlderPoints": "",
        "removeOlderUnit": "3600",
        "cutout": 0,
        "useOneColor": false,
        "useUTC": false,
        "colors": [
            "#1f77b4",
            "#aec7e8",
            "#ff7f0e",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "outputs": 1,
        "x": 1830,
        "y": 800,
        "wires": [
            []
        ]
    },
    {
        "id": "f3e2c3ad.8ebb2",
        "type": "ui_toast",
        "z": "5127740.f28848c",
        "position": "top right",
        "displayTime": "3",
        "highlight": "",
        "sendall": true,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "topic": "Water PH",
        "name": "Alert ",
        "x": 1010,
        "y": 184,
        "wires": []
    },
    {
        "id": "ec42ca0e.6c9dd8",
        "type": "ui_template",
        "z": "1d22c714.e50369",
        "group": "f0e58282.f2736",
        "name": "Seed tray image",
        "order": 1,
        "width": 8,
        "height": 8,
        "format": "<md-card class=\"md-primary\">\n  \n  <md-card-actions>\n   <md-button ng-click=\"send({payload:1})\" >\n       <ui-icon icon=\"camera\"></ui-icon>Take a photo<br>\n   </md-button>\n   <md-button ng-click=\"send({payload:1})\" >\n     <i class=\"fa fa-refresh\" aria-hidden=\"true\">  {{timestamp | date: 'MMM d, y - HH:mm:ss'}}</i>\n   </md-button>\n  </md-card-actions>\n  \n  <md-card-header>\n    <md-card-media>\n         <img width=\"360\" height=\"240\" src=\"{{photoURL}}\" class=\"md-card-image\" >\n    </md-card-media>\n  </md-card-header>\n\n</md-card>\n\n\n\n<script>\n\n(function(scope) {\n    // $watch fires each time the node is triggered in the flow\n    scope.$watch('msg', function(msg) {\n        scope.timestamp = new Date();\n        scope.photoURL = \"/photo1.JPEG?_=\" + new Date();\n    });\n\n})(scope);\n\n</script>",
        "storeOutMessages": true,
        "fwdInMessages": false,
        "resendOnRefresh": true,
        "templateScope": "local",
        "x": 370,
        "y": 1840,
        "wires": [
            [
                "134f40ec.1ec4bf"
            ]
        ]
    },
    {
        "id": "f9da79c2.9a6128",
        "type": "ui_text",
        "z": "1d22c714.e50369",
        "group": "1c37dc0b.ce28e4",
        "order": 2,
        "width": 4,
        "height": 1,
        "name": "Timezone",
        "label": "",
        "format": "{{msg.payload.timezone}}",
        "layout": "row-left",
        "x": 1260,
        "y": 60,
        "wires": []
    },
    {
        "id": "b5d6c4cf.de8008",
        "type": "mqtt in",
        "z": "1d22c714.e50369",
        "name": "",
        "topic": "hydro/state/arduino",
        "qos": "0",
        "datatype": "auto",
        "broker": "a0e631b8.d383b",
        "x": 210,
        "y": 320,
        "wires": [
            [
                "c278aca9.b3501"
            ]
        ]
    },
    {
        "id": "c278aca9.b3501",
        "type": "ui_text",
        "z": "1d22c714.e50369",
        "group": "ae8ddbfd.c58db8",
        "order": 1,
        "width": 4,
        "height": 2,
        "name": "arduino state",
        "label": "Arduino ",
        "format": "{{msg.payload}}",
        "layout": "row-center",
        "x": 410,
        "y": 320,
        "wires": []
    },
    {
        "id": "241d7684.cf23fa",
        "type": "remote-access",
        "z": "1d22c714.e50369",
        "confignode": "9f76d55b.b58878",
        "name": "",
        "x": 180,
        "y": 60,
        "wires": []
    },
    {
        "id": "5d2f5ff2.180c5",
        "type": "delay",
        "z": "87cb301d.9893c",
        "name": "",
        "pauseType": "delayv",
        "timeout": "20",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 960,
        "y": 900,
        "wires": [
            [
                "a7364d44.56698"
            ]
        ]
    },
    {
        "id": "5be7de2e.ba1d2",
        "type": "mqtt out",
        "z": "87cb301d.9893c",
        "name": "Nutriments",
        "topic": "hydro/nutriments/switch",
        "qos": "0",
        "retain": "",
        "broker": "a0e631b8.d383b",
        "x": 530,
        "y": 820,
        "wires": []
    },
    {
        "id": "a7364d44.56698",
        "type": "change",
        "z": "87cb301d.9893c",
        "name": "Switch to off",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "false",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1110,
        "y": 900,
        "wires": [
            [
                "648ce0a1.8a9de"
            ]
        ]
    },
    {
        "id": "93cd22de.a5d2c",
        "type": "switch",
        "z": "87cb301d.9893c",
        "name": "When nutriments spray on",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 340,
        "y": 900,
        "wires": [
            [
                "bb16ff0b.197e6"
            ]
        ]
    },
    {
        "id": "648ce0a1.8a9de",
        "type": "ui_switch",
        "z": "87cb301d.9893c",
        "name": "Nutriments",
        "label": "<i class=\"fa fa-angle-double-up\"></i> Nutriments",
        "tooltip": "",
        "group": "8d4aab9b.4d6328",
        "order": 7,
        "width": 5,
        "height": 1,
        "passthru": true,
        "decouple": "false",
        "topic": "",
        "style": "",
        "onvalue": "true",
        "onvalueType": "bool",
        "onicon": "",
        "oncolor": "",
        "offvalue": "false",
        "offvalueType": "bool",
        "officon": "",
        "offcolor": "",
        "x": 310,
        "y": 820,
        "wires": [
            [
                "93cd22de.a5d2c",
                "5be7de2e.ba1d2"
            ]
        ]
    },
    {
        "id": "9cd0faa8.7a4eb8",
        "type": "mqtt in",
        "z": "1d22c714.e50369",
        "name": "",
        "topic": "hydro/nutriments/s",
        "qos": "0",
        "datatype": "auto",
        "broker": "a0e631b8.d383b",
        "x": 205,
        "y": 1700,
        "wires": [
            [
                "2617b5f9.5aa3da"
            ]
        ]
    },
    {
        "id": "2617b5f9.5aa3da",
        "type": "ui_led",
        "z": "1d22c714.e50369",
        "group": "8d4aab9b.4d6328",
        "order": 8,
        "width": 2,
        "height": 1,
        "label": "",
        "labelPlacement": "left",
        "labelAlignment": "left",
        "colorForValue": [
            {
                "color": "red",
                "value": "false",
                "valueType": "str"
            },
            {
                "color": "green",
                "value": "true",
                "valueType": "str"
            }
        ],
        "allowColorForValueInMessage": false,
        "name": "Nutriments",
        "x": 385,
        "y": 1700,
        "wires": []
    },
    {
        "id": "821d2e1a.d0244",
        "type": "ui_gauge",
        "z": "1d22c714.e50369",
        "name": "Water level",
        "group": "65d119b5.66cb78",
        "order": 8,
        "width": 4,
        "height": 4,
        "gtype": "wave",
        "title": "Water level",
        "label": "%",
        "format": "{{value}}",
        "min": 0,
        "max": "100",
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "",
        "seg2": "",
        "x": 1030,
        "y": 1220,
        "wires": []
    },
    {
        "id": "b1c0fbbf.8e9c58",
        "type": "influxdb out",
        "z": "1d22c714.e50369",
        "influxdb": "8193652c.e6bda8",
        "name": "",
        "measurement": "water_level",
        "precision": "",
        "retentionPolicy": "",
        "database": "database",
        "precisionV18FluxV20": "ms",
        "retentionPolicyV18Flux": "",
        "org": "organisation",
        "bucket": "bucket",
        "x": 860,
        "y": 1260,
        "wires": []
    },
    {
        "id": "ce4f2657.0c3588",
        "type": "delay",
        "z": "1d22c714.e50369",
        "name": "",
        "pauseType": "delay",
        "timeout": "2",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 760,
        "y": 1300,
        "wires": [
            [
                "f0da22f5.a0782"
            ]
        ]
    },
    {
        "id": "8e23d689.2cf748",
        "type": "function",
        "z": "1d22c714.e50369",
        "name": "Parse telemetry JSON",
        "func": "\nvar newMsg =  { \n        payload: new Date(msg.payload[0].time)\n};\nreturn newMsg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 1180,
        "y": 1300,
        "wires": [
            [
                "62029373.97ee9c"
            ]
        ]
    },
    {
        "id": "f0da22f5.a0782",
        "type": "influxdb in",
        "z": "1d22c714.e50369",
        "influxdb": "8193652c.e6bda8",
        "name": "Select last entry",
        "query": "SELECT * FROM water_level GROUP BY * ORDER BY DESC LIMIT 1",
        "rawOutput": false,
        "precision": "",
        "retentionPolicy": "",
        "org": "organisation",
        "x": 920,
        "y": 1300,
        "wires": [
            [
                "8e23d689.2cf748"
            ]
        ]
    },
    {
        "id": "62029373.97ee9c",
        "type": "ui_text",
        "z": "1d22c714.e50369",
        "group": "65d119b5.66cb78",
        "order": 2,
        "width": 3,
        "height": 1,
        "name": "Last refresh - water level",
        "label": "",
        "format": "<i class=\"fa fa-refresh\" aria-hidden=\"true\">&nbsp; {{ msg.payload | date: 'HH:mm:ss'}}</i> ",
        "layout": "row-center",
        "x": 1410,
        "y": 1300,
        "wires": []
    },
    {
        "id": "4c00e295.9a2f5c",
        "type": "inject",
        "z": "5127740.f28848c",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "2700",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 130,
        "y": 140,
        "wires": [
            [
                "1b07e4d1.7c4d9b"
            ]
        ]
    },
    {
        "id": "f76a168.49897e8",
        "type": "function",
        "z": "5127740.f28848c",
        "name": "Simulate an input",
        "func": "msg.payload = \"PH too low\"\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 830,
        "y": 224,
        "wires": [
            [
                "f3e2c3ad.8ebb2"
            ]
        ]
    },
    {
        "id": "5d9dc44f.a6cccc",
        "type": "switch",
        "z": "5127740.f28848c",
        "name": "PPM conditions, min and max values",
        "property": "payload[0].mean",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gt",
                "v": "maxPPM",
                "vt": "global"
            },
            {
                "t": "lt",
                "v": "minPPM",
                "vt": "global"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 530,
        "y": 380,
        "wires": [
            [
                "78ee2d93.0854e4"
            ],
            [
                "7485b5.c5f5ca4c"
            ]
        ]
    },
    {
        "id": "78ee2d93.0854e4",
        "type": "function",
        "z": "5127740.f28848c",
        "name": "Simulate an input",
        "func": "msg.payload = \"PPM too high\"\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 830,
        "y": 344,
        "wires": [
            [
                "7ebdaedb.473e9"
            ]
        ]
    },
    {
        "id": "6b31749d.19ee4c",
        "type": "influxdb in",
        "z": "5127740.f28848c",
        "influxdb": "8193652c.e6bda8",
        "name": "Mean PPM over last 20min",
        "query": "SELECT mean(value) FROM water_quality WHERE time >= now() - 20m",
        "rawOutput": false,
        "precision": "",
        "retentionPolicy": "",
        "org": "organisation",
        "x": 200,
        "y": 380,
        "wires": [
            [
                "5d9dc44f.a6cccc"
            ]
        ]
    },
    {
        "id": "7ebdaedb.473e9",
        "type": "ui_toast",
        "z": "5127740.f28848c",
        "position": "top right",
        "displayTime": "3",
        "highlight": "",
        "sendall": true,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "topic": "Water PPM",
        "name": "Alert ",
        "x": 1010,
        "y": 364,
        "wires": []
    },
    {
        "id": "7485b5.c5f5ca4c",
        "type": "function",
        "z": "5127740.f28848c",
        "name": "Simulate an input",
        "func": "msg.payload = \"PPM too low\"\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 830,
        "y": 404,
        "wires": [
            [
                "7ebdaedb.473e9"
            ]
        ]
    },
    {
        "id": "4c35d949.85d758",
        "type": "file",
        "z": "87cb301d.9893c",
        "name": "WriteFile",
        "filename": "/home/pi/.node-red/projects/hydro/time-scheduler.txt",
        "appendNewline": true,
        "createDir": true,
        "overwriteFile": "true",
        "encoding": "none",
        "x": 601,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "6705ebab.d4f8a4",
        "type": "inject",
        "z": "87cb301d.9893c",
        "name": "FireAfterReboot",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 180,
        "y": 46,
        "wires": [
            [
                "8dafbb4d.b18898"
            ]
        ]
    },
    {
        "id": "8dafbb4d.b18898",
        "type": "file in",
        "z": "87cb301d.9893c",
        "name": "ReadFile",
        "filename": "/home/pi/.node-red/projects/hydro/time-scheduler.txt",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "x": 360,
        "y": 46,
        "wires": [
            [
                "28cc1585.a3940a"
            ]
        ]
    },
    {
        "id": "28cc1585.a3940a",
        "type": "ui_time_scheduler",
        "z": "87cb301d.9893c",
        "group": "72b67add.961f74",
        "name": "Scheduler",
        "startDay": "1",
        "refresh": 60,
        "devices": [
            "Schedule grow lights",
            "Schedule water pump"
        ],
        "customPayload": false,
        "eventMode": true,
        "outputs": 3,
        "order": 1,
        "width": 6,
        "height": 1,
        "x": 300,
        "y": 240,
        "wires": [
            [
                "4c35d949.85d758"
            ],
            [
                "df864faf.11005"
            ],
            [
                "c1e51a25.bcd2f8"
            ]
        ]
    },
    {
        "id": "e7786898.4b6868",
        "type": "ui_slider",
        "z": "87cb301d.9893c",
        "name": "PPM min. value",
        "label": "Min. PPM",
        "tooltip": "Minimum PPM threshold to trigger event",
        "group": "c6be6d42.f806a",
        "order": 1,
        "width": 6,
        "height": 1,
        "passthru": true,
        "outs": "end",
        "topic": "",
        "min": 0,
        "max": "1400",
        "step": "10",
        "x": 520,
        "y": 1180,
        "wires": [
            [
                "db9050e4.c89ba",
                "af84a357.025ea",
                "f4e8ce43.86774"
            ]
        ]
    },
    {
        "id": "49bf0c8e.06b714",
        "type": "ui_slider",
        "z": "87cb301d.9893c",
        "name": "PPM max. value",
        "label": "Max. PPM",
        "tooltip": "Max PPM threshold to trigger event",
        "group": "c6be6d42.f806a",
        "order": 3,
        "width": 6,
        "height": 1,
        "passthru": true,
        "outs": "end",
        "topic": "",
        "min": 0,
        "max": "1400",
        "step": "10",
        "x": 520,
        "y": 1320,
        "wires": [
            [
                "86b27ad6.f2ac78",
                "b5da2f47.50eca",
                "ceb34ebd.f74e8"
            ]
        ]
    },
    {
        "id": "db9050e4.c89ba",
        "type": "ui_text",
        "z": "87cb301d.9893c",
        "group": "c6be6d42.f806a",
        "order": 2,
        "width": 1,
        "height": 1,
        "name": "PPM min value",
        "label": "",
        "format": "{{msg.payload}}",
        "layout": "row-center",
        "x": 760,
        "y": 1180,
        "wires": []
    },
    {
        "id": "86b27ad6.f2ac78",
        "type": "ui_text",
        "z": "87cb301d.9893c",
        "group": "c6be6d42.f806a",
        "order": 4,
        "width": 1,
        "height": 1,
        "name": "PPM max value",
        "label": "",
        "format": "{{msg.payload}}",
        "layout": "row-center",
        "x": 760,
        "y": 1320,
        "wires": []
    },
    {
        "id": "af84a357.025ea",
        "type": "function",
        "z": "87cb301d.9893c",
        "name": "Save global variable",
        "func": "\nglobal.set('minPPM',msg.payload);\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 780,
        "y": 1220,
        "wires": [
            []
        ]
    },
    {
        "id": "b5da2f47.50eca",
        "type": "function",
        "z": "87cb301d.9893c",
        "name": "Save global variable",
        "func": "\nglobal.set('maxPPM',msg.payload);\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 780,
        "y": 1360,
        "wires": [
            []
        ]
    },
    {
        "id": "23810c02.07fa14",
        "type": "inject",
        "z": "5127740.f28848c",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "2700",
        "crontab": "",
        "once": true,
        "onceDelay": "1",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 132,
        "y": 326,
        "wires": [
            [
                "6b31749d.19ee4c"
            ]
        ]
    },
    {
        "id": "f4e8ce43.86774",
        "type": "persist in",
        "z": "87cb301d.9893c",
        "name": "minPPMValue",
        "storageNode": "217cc961.603ce6",
        "x": 758,
        "y": 1260,
        "wires": []
    },
    {
        "id": "d1ca6b99.9ac888",
        "type": "persist out",
        "z": "87cb301d.9893c",
        "name": "minPPMValue",
        "storageNode": "217cc961.603ce6",
        "x": 320,
        "y": 1180,
        "wires": [
            [
                "e7786898.4b6868"
            ]
        ]
    },
    {
        "id": "ceb34ebd.f74e8",
        "type": "persist in",
        "z": "87cb301d.9893c",
        "name": "maxPPMValue",
        "storageNode": "217cc961.603ce6",
        "x": 760,
        "y": 1400,
        "wires": []
    },
    {
        "id": "1e9754d8.8de89b",
        "type": "persist out",
        "z": "87cb301d.9893c",
        "name": "maxPPMValue",
        "storageNode": "217cc961.603ce6",
        "x": 320,
        "y": 1320,
        "wires": [
            [
                "49bf0c8e.06b714"
            ]
        ]
    },
    {
        "id": "10e9a27.bb9f05e",
        "type": "comment",
        "z": "87cb301d.9893c",
        "name": "### Nutriments controler ###",
        "info": "",
        "x": 260,
        "y": 780,
        "wires": []
    },
    {
        "id": "bb16ff0b.197e6",
        "type": "persist out",
        "z": "87cb301d.9893c",
        "name": "nutrimentsTimer",
        "storageNode": "217cc961.603ce6",
        "x": 600,
        "y": 900,
        "wires": [
            [
                "cf53cc34.c3564"
            ]
        ]
    },
    {
        "id": "cf53cc34.c3564",
        "type": "function",
        "z": "87cb301d.9893c",
        "name": "msg.delay",
        "func": "var newMsg = { delay: (msg.payload * 1000) };\nreturn newMsg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 790,
        "y": 900,
        "wires": [
            [
                "5d2f5ff2.180c5"
            ]
        ]
    },
    {
        "id": "291d0ce5.3b19f4",
        "type": "ui_slider",
        "z": "87cb301d.9893c",
        "name": "Nutriments duration",
        "label": "<i class=\"fa fa-clock-o\"></i>",
        "tooltip": "Nutriments pump duration",
        "group": "8d4aab9b.4d6328",
        "order": 10,
        "width": 3,
        "height": 1,
        "passthru": true,
        "outs": "all",
        "topic": "",
        "min": "1",
        "max": "30",
        "step": 1,
        "x": 520,
        "y": 1000,
        "wires": [
            [
                "bd1a41bd.42258",
                "40ff0cbf.623994",
                "5d69fc.7056c604"
            ]
        ]
    },
    {
        "id": "bd1a41bd.42258",
        "type": "ui_text",
        "z": "87cb301d.9893c",
        "group": "8d4aab9b.4d6328",
        "order": 12,
        "width": 2,
        "height": 1,
        "name": "Nutriments timer ",
        "label": "",
        "format": "{{msg.payload}} sec.",
        "layout": "row-center",
        "x": 750,
        "y": 1000,
        "wires": []
    },
    {
        "id": "40ff0cbf.623994",
        "type": "function",
        "z": "87cb301d.9893c",
        "name": "Save global variable",
        "func": "\nglobal.set('durationNutriments',msg.payload);\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 760,
        "y": 1040,
        "wires": [
            []
        ]
    },
    {
        "id": "5d69fc.7056c604",
        "type": "persist in",
        "z": "87cb301d.9893c",
        "name": "nutrimentsTimer",
        "storageNode": "217cc961.603ce6",
        "x": 738,
        "y": 1080,
        "wires": []
    },
    {
        "id": "ba7f0c0a.aeb54",
        "type": "persist out",
        "z": "87cb301d.9893c",
        "name": "nutrimentsTimer",
        "storageNode": "217cc961.603ce6",
        "x": 300,
        "y": 1000,
        "wires": [
            [
                "291d0ce5.3b19f4"
            ]
        ]
    },
    {
        "id": "9f70aaa.2186658",
        "type": "ui_slider",
        "z": "87cb301d.9893c",
        "name": "PH min. value",
        "label": "Min. PH",
        "tooltip": "Minimum PH threshold to trigger event",
        "group": "c6be6d42.f806a",
        "order": 5,
        "width": 6,
        "height": 1,
        "passthru": true,
        "outs": "end",
        "topic": "",
        "min": 0,
        "max": "14",
        "step": "0.1",
        "x": 520,
        "y": 1480,
        "wires": [
            [
                "39d365e7.6050da",
                "c641ed65.f5f57",
                "a7f8bb1.8dde548"
            ]
        ]
    },
    {
        "id": "c3691815.5595b8",
        "type": "ui_slider",
        "z": "87cb301d.9893c",
        "name": "PH max. value",
        "label": "Max. PH",
        "tooltip": "Max PH threshold to trigger event",
        "group": "c6be6d42.f806a",
        "order": 7,
        "width": 6,
        "height": 1,
        "passthru": true,
        "outs": "end",
        "topic": "",
        "min": 0,
        "max": "14",
        "step": "0.1",
        "x": 520,
        "y": 1620,
        "wires": [
            [
                "4d4ca970.a006e8",
                "1472213f.e9cedf",
                "cd446bb0.6460e8"
            ]
        ]
    },
    {
        "id": "39d365e7.6050da",
        "type": "ui_text",
        "z": "87cb301d.9893c",
        "group": "c6be6d42.f806a",
        "order": 6,
        "width": 1,
        "height": 1,
        "name": "PH min value",
        "label": "",
        "format": "{{msg.payload}}",
        "layout": "row-center",
        "x": 750,
        "y": 1480,
        "wires": []
    },
    {
        "id": "4d4ca970.a006e8",
        "type": "ui_text",
        "z": "87cb301d.9893c",
        "group": "c6be6d42.f806a",
        "order": 8,
        "width": 1,
        "height": 1,
        "name": "PH max value",
        "label": "",
        "format": "{{msg.payload}}",
        "layout": "row-center",
        "x": 760,
        "y": 1620,
        "wires": []
    },
    {
        "id": "c641ed65.f5f57",
        "type": "function",
        "z": "87cb301d.9893c",
        "name": "Save global variable",
        "func": "\nglobal.set('minPH',msg.payload);\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 780,
        "y": 1520,
        "wires": [
            []
        ]
    },
    {
        "id": "1472213f.e9cedf",
        "type": "function",
        "z": "87cb301d.9893c",
        "name": "Save global variable",
        "func": "\nglobal.set('maxPH',msg.payload);\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 780,
        "y": 1660,
        "wires": [
            []
        ]
    },
    {
        "id": "a7f8bb1.8dde548",
        "type": "persist in",
        "z": "87cb301d.9893c",
        "name": "minPHValue",
        "storageNode": "217cc961.603ce6",
        "x": 748,
        "y": 1560,
        "wires": []
    },
    {
        "id": "1f233803.3e17d8",
        "type": "persist out",
        "z": "87cb301d.9893c",
        "name": "minPHValue",
        "storageNode": "217cc961.603ce6",
        "x": 310,
        "y": 1480,
        "wires": [
            [
                "9f70aaa.2186658"
            ]
        ]
    },
    {
        "id": "cd446bb0.6460e8",
        "type": "persist in",
        "z": "87cb301d.9893c",
        "name": "maxPHValue",
        "storageNode": "217cc961.603ce6",
        "x": 750,
        "y": 1700,
        "wires": []
    },
    {
        "id": "f5a4944f.91b958",
        "type": "persist out",
        "z": "87cb301d.9893c",
        "name": "maxPHValue",
        "storageNode": "217cc961.603ce6",
        "x": 310,
        "y": 1620,
        "wires": [
            [
                "c3691815.5595b8"
            ]
        ]
    },
    {
        "id": "84888512.5d3ad8",
        "type": "function",
        "z": "1d22c714.e50369",
        "name": "Configure PH sectors",
        "func": "var minPH = global.get('minPH') || 0;\nvar maxPH = global.get('maxPH') || 0;\nvar centerPH = parseInt((minPH + maxPH) / 2);\n\nvar newSectors = [\n    {t:\"min\",val:0,col:\"#ff5252\",dot:0},\n    {t:\"sec\",val:minPH,col:\"#4CAF50\",dot:5},\n    {t:\"sec\",val:maxPH,col:\"#ff5252\",dot:5},\n    {t:\"max\",val:14,col:\"#ff5252\",dot:0}] \n\n\nmsg.control = \n  {sectors:newSectors, center: centerPH}\n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 800,
        "y": 1000,
        "wires": [
            [
                "4d58abb1.177e64"
            ]
        ]
    },
    {
        "id": "b2d124cc.ae5b18",
        "type": "function",
        "z": "1d22c714.e50369",
        "name": "Configure PPM sectors",
        "func": "var minPPM = global.get('minPPM') || 0;\nvar maxPPM = global.get('maxPPM') || 0;\nvar centerPPM = parseInt((minPPM + maxPPM) / 2);\n\nvar newSectors = [\n    {t:\"min\",val:0,col:\"#ff5252\",dot:0},\n    {t:\"sec\",val:minPPM,col:\"#4CAF50\",dot:5},\n    {t:\"sec\",val:maxPPM,col:\"#ff5252\",dot:5},\n    {t:\"max\",val:1500,col:\"#ff5252\",dot:0}] \n\n\nmsg.control = \n  {sectors:newSectors, center: centerPPM}\n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 830,
        "y": 420,
        "wires": [
            [
                "63de4a5e.7c19a4"
            ]
        ]
    },
    {
        "id": "110629fe.763406",
        "type": "ui_slider",
        "z": "87cb301d.9893c",
        "name": "Water spray duration",
        "label": "<i class=\"fa fa-clock-o\"></i>",
        "tooltip": "Water spray duration",
        "group": "8d4aab9b.4d6328",
        "order": 4,
        "width": 3,
        "height": 1,
        "passthru": true,
        "outs": "all",
        "topic": "",
        "min": "0",
        "max": "60",
        "step": "5",
        "x": 840,
        "y": 579,
        "wires": [
            [
                "93114461.f1f738",
                "5a0bf1b0.dfae1",
                "9fd964ad.e79258"
            ]
        ]
    },
    {
        "id": "93114461.f1f738",
        "type": "ui_text",
        "z": "87cb301d.9893c",
        "group": "8d4aab9b.4d6328",
        "order": 5,
        "width": 2,
        "height": 1,
        "name": "Water spray duration min value",
        "label": "",
        "format": "{{msg.payload}} sec.",
        "layout": "row-center",
        "x": 1111,
        "y": 540,
        "wires": []
    },
    {
        "id": "5a0bf1b0.dfae1",
        "type": "function",
        "z": "87cb301d.9893c",
        "name": "Save global variable",
        "func": "\nglobal.set('durationWaterSpray',msg.payload);\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 1081,
        "y": 580,
        "wires": [
            []
        ]
    },
    {
        "id": "9fd964ad.e79258",
        "type": "persist in",
        "z": "87cb301d.9893c",
        "name": "waterSprayTimer",
        "storageNode": "217cc961.603ce6",
        "x": 1071,
        "y": 620,
        "wires": []
    },
    {
        "id": "72a3076f.713e68",
        "type": "persist out",
        "z": "87cb301d.9893c",
        "name": "waterSprayTimer",
        "storageNode": "217cc961.603ce6",
        "x": 630,
        "y": 579,
        "wires": [
            [
                "110629fe.763406"
            ]
        ]
    },
    {
        "id": "57e4ad43.c33774",
        "type": "persist out",
        "z": "87cb301d.9893c",
        "name": "waterSprayTimer",
        "storageNode": "217cc961.603ce6",
        "x": 1111,
        "y": 480,
        "wires": [
            [
                "77dd4f6a.f114"
            ]
        ]
    },
    {
        "id": "77dd4f6a.f114",
        "type": "function",
        "z": "87cb301d.9893c",
        "name": "msg.delay",
        "func": "var newMsg = { delay: (msg.payload * 1000) };\nreturn newMsg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 1311,
        "y": 480,
        "wires": [
            [
                "b9dd843.3247178"
            ]
        ]
    },
    {
        "id": "457aff73.050d9",
        "type": "comment",
        "z": "5127740.f28848c",
        "name": "### Adjust PH rule",
        "info": "",
        "x": 150,
        "y": 80,
        "wires": []
    },
    {
        "id": "9bfd2d56.7eae1",
        "type": "comment",
        "z": "5127740.f28848c",
        "name": "### Adjust PPM rule",
        "info": "",
        "x": 150,
        "y": 280,
        "wires": []
    },
    {
        "id": "b8023ba0.969078",
        "type": "function",
        "z": "1d22c714.e50369",
        "name": "Configure gauge widget",
        "func": "msg.ui_control = {options: {\n    textColor:\"#FFFFFF\", \n    waveTextColor:\"#FFFFFF\", \n    textSize: 0.7,\n    textVertPosition: .6,\n    displayPercent: true,\n    waveColor:\"#0fbaac\",\n    //waveAnimate: true,\n    //waveAnimateTime: 200000,\n    //waveCount: 3,\n    waveOffset: 0.25,\n    circleThickness: 0.05,\n    circleColor: \"#0fbaac\",\n    valueCountUp: false // disable count up upon loading \n\n }\n};\nmsg.payload = parseInt(msg.payload * 100 / 7);\nreturn msg; ",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 810,
        "y": 1220,
        "wires": [
            [
                "821d2e1a.d0244"
            ]
        ]
    },
    {
        "id": "da7d1a1e.239e58",
        "type": "kasa",
        "z": "87cb301d.9893c",
        "name": "Hydroponic - Water pump  - HS105(JP)",
        "device": "10.0.0.12",
        "interval": 60000,
        "eventInterval": 15000,
        "payload": "getInfo",
        "payloadType": "info",
        "debug": false,
        "x": 490,
        "y": 1880,
        "wires": [
            [
                "652a6ac7.e928e4"
            ]
        ]
    },
    {
        "id": "652a6ac7.e928e4",
        "type": "debug",
        "z": "87cb301d.9893c",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 770,
        "y": 1880,
        "wires": []
    },
    {
        "id": "a1199c3c.fc4d",
        "type": "inject",
        "z": "87cb301d.9893c",
        "name": "",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "false",
        "payloadType": "bool",
        "x": 270,
        "y": 1920,
        "wires": [
            [
                "da7d1a1e.239e58"
            ]
        ]
    },
    {
        "id": "55a6cf23.d511",
        "type": "inject",
        "z": "87cb301d.9893c",
        "name": "",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "true",
        "payloadType": "bool",
        "x": 280,
        "y": 1840,
        "wires": [
            [
                "da7d1a1e.239e58"
            ]
        ]
    },
    {
        "id": "d9cef345.e508b",
        "type": "comment",
        "z": "87cb301d.9893c",
        "name": "### Hydro solution ###",
        "info": "",
        "x": 300,
        "y": 1800,
        "wires": []
    },
    {
        "id": "b74e71c3.dd092",
        "type": "ui_valuetrail",
        "z": "1d22c714.e50369",
        "group": "65d119b5.66cb78",
        "order": 10,
        "width": 4,
        "height": 1,
        "name": "Water quality trail",
        "label": "",
        "unit": "",
        "blur": true,
        "minmax": true,
        "showvalue": false,
        "decimals": 0,
        "colorLine": "#ff9900",
        "colorFromTheme": true,
        "stroke": 2,
        "property": "payload",
        "pointcount": 8,
        "x": 810,
        "y": 380,
        "wires": []
    },
    {
        "id": "58d46bc7.965d04",
        "type": "ui_valuetrail",
        "z": "1d22c714.e50369",
        "group": "65d119b5.66cb78",
        "order": 9,
        "width": 4,
        "height": 1,
        "name": "Water PH trail",
        "label": "",
        "unit": "",
        "blur": true,
        "minmax": true,
        "showvalue": false,
        "decimals": "1",
        "colorLine": "#ff9900",
        "colorFromTheme": true,
        "stroke": 2,
        "property": "payload",
        "pointcount": 8,
        "x": 780,
        "y": 960,
        "wires": []
    },
    {
        "id": "7116d9ef.642a58",
        "type": "ui_valuetrail",
        "z": "1d22c714.e50369",
        "group": "65d119b5.66cb78",
        "order": 11,
        "width": 4,
        "height": 1,
        "name": "Water level trail",
        "label": "",
        "unit": "",
        "blur": true,
        "minmax": true,
        "showvalue": false,
        "decimals": "2",
        "colorLine": "#ff9900",
        "colorFromTheme": true,
        "stroke": 2,
        "property": "payload",
        "pointcount": 8,
        "x": 780,
        "y": 1180,
        "wires": []
    },
    {
        "id": "6c1d8e8.c6bf77",
        "type": "function",
        "z": "1d22c714.e50369",
        "name": "Save Global variable - total natural light",
        "func": "var sunrise = new Date(msg.payload.current.sunrise);\nvar sunset = new Date(msg.payload.current.sunset);\nvar totalNaturalLight = sunset - sunrise;\n\nglobal.set('sun.total', totalNaturalLight);\n\nmsg.payload = totalNaturalLight;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 960,
        "y": 280,
        "wires": [
            [
                "15bc06eb.0cde59"
            ]
        ]
    },
    {
        "id": "8b1e31fb.674d8",
        "type": "ui_text",
        "z": "1d22c714.e50369",
        "group": "45199dde.854f64",
        "order": 5,
        "width": 5,
        "height": 1,
        "name": "Sun light",
        "label": "<i class=\"fa  fa-sun-o\"></i> Sunlight :",
        "format": "{{msg.sun.total}}",
        "layout": "row-spread",
        "x": 400,
        "y": 2020,
        "wires": []
    },
    {
        "id": "40722a2.55018d4",
        "type": "ui_text",
        "z": "1d22c714.e50369",
        "group": "45199dde.854f64",
        "order": 6,
        "width": 5,
        "height": 1,
        "name": "LED light",
        "label": "<i class=\"fa fa-lightbulb-o\"></i> LED light :",
        "format": "{{msg.led.total}}",
        "layout": "row-spread",
        "x": 400,
        "y": 2060,
        "wires": []
    },
    {
        "id": "f29c482.590a3b8",
        "type": "ui_text",
        "z": "1d22c714.e50369",
        "group": "45199dde.854f64",
        "order": 7,
        "width": 5,
        "height": 1,
        "name": "Dark mode",
        "label": "<i class=\"fa  fa-moon-o\"></i> Dark: ",
        "format": "{{msg.dark.total}}",
        "layout": "row-spread",
        "x": 410,
        "y": 2100,
        "wires": []
    },
    {
        "id": "7b62dc10.8cd624",
        "type": "function",
        "z": "1d22c714.e50369",
        "name": "",
        "func": "var timestampSunLight = global.get('sun.total'); // in seconds\nvar totalLight = global.get('seed.totalLight') * 60 * 60; // in seconds\n\nvar ledLight = totalLight - timestampSunLight;\nvar darkMode = 24*60*60 - totalLight;\n\nfunction format(time) {   \n    // Hours, minutes and seconds\n    var hrs = ~~(time / 3600);\n    var mins = ~~((time % 3600) / 60);\n\n    // Output like \"1:01\" or \"4:03\" or \"123:03\"\n    var ret = \"\";\n    if (hrs > 0) {\n        ret += \"\" + hrs + \" hr \"; \n        if (mins > 0) {\n            ret += (mins < 10 ? \"0\" : \"\") + mins + \" min\";\n        }\n    }\n    return ret;\n}\n\nmsg = {\n    \"sun\": {\n        \"total\": format(timestampSunLight)\n    }, \n    \"led\": {\n        \"total\": format(ledLight)\n    },\n    \"dark\" : {\n        \"total\": format(darkMode)\n    }\n};\n\n\n var series =[\"Sun light\", \"LED\", \"Dark\"];\n var labels = [\"Sun light\", \"LED\", \"Dark\"];\n var data = [];\n var dataWaterQuality = [];\n var dataWaterPH = [];\n var dataWaterTemperature = [];\n var dataLuminosity = [];\n\n data = [930, 300, (2400-(930+300))];\n    \n msg.payload = [{series, data, labels}];\n\nvar m = {};\nm.labels = [\"Sun light\", \"LED\", \"Darks\"];\nm.data = [[timestampSunLight, ledLight, darkMode]];\nm.series = [\"Total light\"];\nmsg.payload = [m];\nmsg.topic = \"\";\n\n\nreturn msg;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 200,
        "y": 2020,
        "wires": [
            [
                "8b1e31fb.674d8",
                "abb9ac18.9b28d",
                "40722a2.55018d4",
                "f29c482.590a3b8"
            ],
            []
        ]
    },
    {
        "id": "15bc06eb.0cde59",
        "type": "link out",
        "z": "1d22c714.e50369",
        "name": "Global var - Total day light",
        "links": [
            "de54877b.8ab618"
        ],
        "x": 1125,
        "y": 360,
        "wires": []
    },
    {
        "id": "de54877b.8ab618",
        "type": "link in",
        "z": "1d22c714.e50369",
        "name": "",
        "links": [
            "15bc06eb.0cde59"
        ],
        "x": 95,
        "y": 2020,
        "wires": [
            [
                "7b62dc10.8cd624"
            ]
        ]
    },
    {
        "id": "abb9ac18.9b28d",
        "type": "ui_chart",
        "z": "1d22c714.e50369",
        "name": "Pi char - Light split",
        "group": "45199dde.854f64",
        "order": 4,
        "width": 4,
        "height": 3,
        "label": "",
        "chartType": "pie",
        "legend": "false",
        "xformat": "HH:mm:ss",
        "interpolate": "linear",
        "nodata": "",
        "dot": false,
        "ymin": "",
        "ymax": "",
        "removeOlder": 1,
        "removeOlderPoints": "",
        "removeOlderUnit": "3600",
        "cutout": "75",
        "useOneColor": false,
        "useUTC": false,
        "colors": [
            "#ff7f18",
            "#f5e056",
            "#d9d9d9",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "outputs": 1,
        "x": 430,
        "y": 2140,
        "wires": [
            []
        ]
    },
    {
        "id": "c9a5fcab.6996d",
        "type": "ui_slider",
        "z": "87cb301d.9893c",
        "name": "Total light",
        "label": "<i class=\"fa fa-clock-o\"></i>",
        "tooltip": "Total light",
        "group": "45199dde.854f64",
        "order": 12,
        "width": 3,
        "height": 1,
        "passthru": true,
        "outs": "all",
        "topic": "",
        "min": "0",
        "max": "24",
        "step": "1",
        "x": 781,
        "y": 260,
        "wires": [
            [
                "cb63798e.fcba98",
                "9cd5273c.8a7168",
                "7f12ae51.caa38",
                "a3e3f133.15036"
            ]
        ]
    },
    {
        "id": "cb63798e.fcba98",
        "type": "ui_text",
        "z": "87cb301d.9893c",
        "group": "45199dde.854f64",
        "order": 13,
        "width": 2,
        "height": 1,
        "name": "Total light duration",
        "label": "",
        "format": "{{msg.payload}} hours.",
        "layout": "row-center",
        "x": 991,
        "y": 260,
        "wires": []
    },
    {
        "id": "9cd5273c.8a7168",
        "type": "function",
        "z": "87cb301d.9893c",
        "name": "Save global variable",
        "func": "global.set('seed.totalLight',msg.payload);",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 1001,
        "y": 300,
        "wires": [
            []
        ]
    },
    {
        "id": "7f12ae51.caa38",
        "type": "persist in",
        "z": "87cb301d.9893c",
        "name": "seed.totalLight",
        "storageNode": "217cc961.603ce6",
        "x": 981,
        "y": 340,
        "wires": []
    },
    {
        "id": "4f4df159.c4c5a",
        "type": "persist out",
        "z": "87cb301d.9893c",
        "name": "seed.totalLight",
        "storageNode": "217cc961.603ce6",
        "x": 620,
        "y": 260,
        "wires": [
            [
                "c9a5fcab.6996d"
            ]
        ]
    },
    {
        "id": "a3e3f133.15036",
        "type": "link out",
        "z": "87cb301d.9893c",
        "name": "Change total light slider",
        "links": [
            "3dfc5ff2.440c6"
        ],
        "x": 916,
        "y": 220,
        "wires": []
    },
    {
        "id": "3dfc5ff2.440c6",
        "type": "link in",
        "z": "1d22c714.e50369",
        "name": "",
        "links": [
            "a3e3f133.15036"
        ],
        "x": 95,
        "y": 2080,
        "wires": [
            [
                "7b62dc10.8cd624"
            ]
        ]
    },
    {
        "id": "9a2a7615.455c48",
        "type": "ui_template",
        "z": "20c682c8.b59efe",
        "group": "9b8f575a.b741a8",
        "name": "css etc",
        "order": 4,
        "width": "0",
        "height": "0",
        "format": "<style>\n\n.filled { height: 48px !important;padding: 0 !important; margin: 0 !important;}\n.nr-dashboard-template { padding: 0; margin: 0;}\n.rounded { border-radius: 12px 12px 12px 12px;}\n.bigfont { font-size: 18px;}\n.smallfont { font-size: 12px;}\n.thedays { cursor:pointer; vertical-align:bottom; height:48px; }\n.the2px  { background-color: #9E9E9E; height:2px; }\n.theblocks {width:100%; height:0%; background-color:#4CAF50; }\n.greybuttons { background-color:#009688 !important; width:48px; border: none;}\n.thetemps { cursor:pointer; font-size:70%; color:#9E9E9E !important; }\n.smallheadings { color:white; font-size:80%; }\n\n</style>\n\n<script>\nvar current=1;\n\n$('.vibrate').on('click', function() {\n  navigator.vibrate(100);\n});\n\nfunction restore_bg(x) {\n            $(this).css(\"background-color\", x);\n    };\n\n$('.touched').on('mousedown', function() {\n    \n    var x= $(this).css(\"background-color\");\n    $(this).css(\"background-color\", \"yellow\");\n    \n    setTimeout(restore_bg.bind(this,x),50);\n    navigator.vibrate(80);\n    });\n    \n</script>",
        "storeOutMessages": false,
        "fwdInMessages": true,
        "x": 660,
        "y": 1580,
        "wires": [
            []
        ]
    },
    {
        "id": "dfd41566.f73768",
        "type": "ui_template",
        "z": "20c682c8.b59efe",
        "group": "9b8f575a.b741a8",
        "name": "Settings page",
        "order": 3,
        "width": "6",
        "height": "6",
        "format": "<script>\nvar thedays=[\"DOMENICA\",\"LUNEDI\",\"MARTEDI\",\"MERCOLEDI\",\"GIOVEDI\",\"VENERDI\",\"SABATO\"];\nvar ID = \"AA\";\n\nvar last=29;\n\nfunction bar(mm,val)\n{\nif (val==14) { $(mm).height(\"12%\"); $(mm).css('background-color', '#1E88E5'); } //blue\nif (val==15) { $(mm).height(\"16%\"); $(mm).css('background-color', '#039BE5'); }\nif (val==16) { $(mm).height(\"20%\"); $(mm).css('background-color', '#00ACC1'); } \nif (val==17) { $(mm).height(\"24%\"); $(mm).css('background-color', '#039BE5'); } // cyan\nif (val==18) { $(mm).height(\"28%\"); $(mm).css('background-color', '#00ACC1'); }\nif (val==19) { $(mm).height(\"32%\"); $(mm).css('background-color', '#00897B'); } \nif (val==20) { $(mm).height(\"36%\"); $(mm).css('background-color', '#388E3C'); } // green\nif (val==21) { $(mm).height(\"40%\"); $(mm).css('background-color', '#689F38'); }\nif (val==22) { $(mm).height(\"44%\"); $(mm).css('background-color', '#C0CA33'); }\nif (val==23) { $(mm).height(\"48%\"); $(mm).css('background-color', '#FDD835'); } // yellow\nif (val==24) { $(mm).height(\"52%\"); $(mm).css('background-color', '#FBC02D'); }\nif (val==25) { $(mm).height(\"56%\"); $(mm).css('background-color', '#FFA000'); }\nif (val==26) { $(mm).height(\"60%\"); $(mm).css('background-color','#E64A19'); } // red\n    \n}\n\nfunction stat(text)\n{\n$(\"#info\"+ID).text(text);\nvar tm=setTimeout(function(){ $(\"#info\"+ID).text(\"Ok\"); clearTimeout(tm);}, 3000);\n}\n\nfunction selec(val,sta)\n{\nvar w=\"#td\"+val+ID;\n if (sta) $(w).css('background-color','#4CAF50'); else $(w).css('background-color','#FFC107');\n}\n\n    (function(scope){\n        scope.ID = ID;\n        scope.send({payload: '29'})\n        scope.$watch('msg', function(msg) {\n            selec(last,0); last=msg.selector; selec(last,1);\n            for (var x=0; x<24; x++) \n                { \n                    var w=\"#t\"+x+ID; bar(w,msg.timing[((msg.days-1)*24)+x]); \n                    var v=\"#v\"+x+ID; $(v).text(msg.timing[((msg.days-1)*24)+x]+\"°\")\n                } \n            for (var x=0; x<2; x++) { var w=\"#s\"+x+ID; $(w).text(msg.timing[168+x]); }\n             $(\"#d0\"+ID).text(thedays[msg.days-1]);\n             if ((last>4) &&(last<29))\n                 $(\"#current\"+ID).text(msg.timing[((msg.days-1)*24)+last-5] + \"°\");\n             else\n                 $(\"#current\"+ID).text(\"-\");\n                 \n            if (msg.foryou!=\"\") { stat(msg.foryou);  }\n            \n             \n        });\n \n    })(scope);\n      \n\n</script>\n<table width=\"100%\">\n    \n    <tr>\n        <td colspan=24><center><span class=\"smallheadings\" >Giorno</span></center></td>\n        <!--<td colspan=3><center><span class=\"smallheadings\">Clima</span></center></td>\n        <td colspan=3><center><span class=\"smallheadings\">Fuori casa</span></center></td>-->\n    </tr>\n   \n    <tr>\n        <td ng-click=\"send({payload: '29'})\" colspan=24><center><span id=\"{{ 'd0' + ID }}\" style=\"cursor:pointer;color:white;font-size:120%\">LUNEDI</span></center></td>\n        <!--<td ng-click=\"send({payload: '1'})\" colspan=3><center><span id=\"s0\" style=\"color:white;font-size:120%\">14</span></center></td>\n        <td ng-click=\"send({payload: '2'})\" colspan=3><center><span id=\"s1\" style=\"color:white;font-size:120%\">20</span></center></td>-->\n    </tr>\n    \n    <tr style=\"height:2px\">\n        <td id=\"{{ 'td29' + ID }}\" colspan=24 style=\"background-color:#9E9E9E;height:2px;\"></td>        \n       <!-- <td id=\"td1\" colspan=3 style=\"background-color:#9E9E9E;height:2px;\"></td>\n        <td id=\"td2\" colspan=3 style=\"background-color:#9E9E9E;height:2px;\"></td>-->\n    </tr>  \n\n    <tr>\n        <td ng-click=\"send({payload: '5'})\" class=\"thedays\"><span id=\"{{ 'v0' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't0' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '6'})\" class=\"thedays\"><span id=\"{{ 'v1' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't1' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '7'})\" class=\"thedays\"><span id=\"{{ 'v2' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't2' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '8'})\" class=\"thedays\"><span id=\"{{ 'v3' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't3' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '9'})\" class=\"thedays\"><span id=\"{{ 'v4' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't4' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '10'})\" class=\"thedays\"><span id=\"{{ 'v5' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't5' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '11'})\" class=\"thedays\"><span id=\"{{ 'v6' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't6' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '12'})\" class=\"thedays\"><span id=\"{{ 'v7' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't7' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '13'})\" class=\"thedays\"><span id=\"{{ 'v8' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't8' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '14'})\" class=\"thedays\"><span id=\"{{ 'v9' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't9' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '15'})\" class=\"thedays\"><span id=\"{{ 'v10' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't10' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '16'})\" class=\"thedays\"><span id=\"{{ 'v11' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't11' + ID }}\" class=\"theblocks\"></div></td>\n    </tr>  \n    \n    <tr style=\"height:2px\">\n        <td id=\"{{ 'td5' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td6' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td7' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td8' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td9' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td10' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td11' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td12' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td13' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td14' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td15' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td16' + ID }}\" class=\"the2px\"></td>\n    </tr>   \n    \n    <tr>\n        <td align=\"center\">0</td>\n        <td align=\"center\">1</td>\n        <td align=\"center\">2</td>\n        <td align=\"center\">3</td>\n        <td align=\"center\">4</td>\n        <td align=\"center\">5</td>\n        <td align=\"center\">6</td>\n        <td align=\"center\">7</td>\n        <td align=\"center\">8</td>\n        <td align=\"center\">9</td>\n        <td align=\"center\">10</td>\n        <td align=\"center\">11</td>\n    </tr> \n    \n    <tr>\n        <td ng-click=\"send({payload: '17'})\" class=\"thedays\"><span id=\"{{ 'v12' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't12' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '18'})\" class=\"thedays\"><span id=\"{{ 'v13' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't13' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '19'})\" class=\"thedays\"><span id=\"{{ 'v14' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't14' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '20'})\" class=\"thedays\"><span id=\"{{ 'v15' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't15' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '21'})\" class=\"thedays\"><span id=\"{{ 'v16' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't16' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '22'})\" class=\"thedays\"><span id=\"{{ 'v17' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't17' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '23'})\" class=\"thedays\"><span id=\"{{ 'v18' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't18' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '24'})\" class=\"thedays\"><span id=\"{{ 'v19' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't19' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '25'})\" class=\"thedays\"><span id=\"{{ 'v20' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't20' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '26'})\" class=\"thedays\"><span id=\"{{ 'v21' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't21' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '27'})\" class=\"thedays\"><span id=\"{{ 'v22' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't22' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '28'})\" class=\"thedays\"><span id=\"{{ 'v23' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't23' + ID }}\" class=\"theblocks\"></div></td>\n    </tr>  \n    \n    <tr style=\"height:2px\">\n        <td id=\"{{ 'td17' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td18' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td19' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td20' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td21' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td22' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td23' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td24' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td25' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td26' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td27' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td28' + ID }}\" class=\"the2px\"></td>\n    </tr>  \n    \n    <tr>\n        <td align=\"center\">12</td>\n        <td align=\"center\">13</td>\n        <td align=\"center\">14</td>\n        <td align=\"center\">15</td>\n        <td align=\"center\">16</td>\n        <td align=\"center\">17</td>\n        <td align=\"center\">18</td>\n        <td align=\"center\">19</td>\n        <td align=\"center\">20</td>\n        <td align=\"center\">21</td>\n        <td align=\"center\">22</td>\n        <td align=\"center\">23</td>\n    </tr> \n    \n    <tr height=\"20px\">\n        <td colspan=2 class=\"smallheadings\">Azioni:</td>\n\n        <td colspan=10 ><center><span id=\"{{ 'info' + ID }}\" class=\"smallheadings\" ></span></center></td>\n\n    </tr>\n    \n    <tr height=\"10px\">\n        <td colspan=\"12\"></td>\n    </tr>\n\n    <tr style=\"height:48px\">\n        <td colspan=2>\n            <button class=\"vibrate filled touched smallfont rounded greybuttons\" ng-click=\"send({payload: 'd'})\"> \n               <ng-md-icon style=\"color: #fff;\" icon=\"keyboard_arrow_down\">\n                    <md-tooltip md-direction=\"bottom\">DECREMENTA</md-tooltip>\n                </ng-md-icon>\n            </button> \n        </td>\n        \n        <td colspan=2><center><span id=\"{{ 'current' + ID }}\" style=\"color:white;font-size:120%\">-</span></center></td>\n\n        <td colspan=2>\n            <button class=\"vibrate filled touched smallfont rounded greybuttons\" ng-click=\"send({payload: 'u'})\"> \n               <ng-md-icon style=\"color: #fff;\" icon=\"keyboard_arrow_up\">\n                    <md-tooltip md-direction=\"bottom\">INCREMENTA</md-tooltip>\n                </ng-md-icon>\n            </button> \n        </td>\n\n        <td colspan=2>\n            <button class=\"vibrate filled touched smallfont rounded greybuttons\" ng-click=\"send({payload: 'r'})\"> \n               <ng-md-icon style=\"color: #fff;\" icon=\"content_copy\">\n                    <md-tooltip md-direction=\"bottom\">COPIA</md-tooltip>\n                </ng-md-icon>\n            </button> \n        </td>\n\n\n        <td colspan=2>\n            <button class=\"vibrate filled touched smallfont rounded greybuttons\" ng-click=\"send({payload: 's'})\"> \n                 <ng-md-icon style=\"color: #fff;\" icon=\"save\">\n                    <md-tooltip md-direction=\"bottom\">SALVA</md-tooltip>\n                </ng-md-icon>\n            </button> \n        </td>\n\n        <td colspan=2>\n            <button class=\"vibrate filled touched smallfont rounded greybuttons\"  ng-click=\"send({payload: 'c'})\"> \n                 <ng-md-icon style=\"color: #fff;\" icon=\"cancel\">\n                    <md-tooltip md-direction=\"bottom\">ANNULLA</md-tooltip>\n                </ng-md-icon>\n            </button> \n        </td>\n        <td colspan=1></td>\n    </tr>\n\n</table>",
        "storeOutMessages": false,
        "fwdInMessages": false,
        "x": 680,
        "y": 1617,
        "wires": [
            [
                "97430b63.1f4c88"
            ]
        ]
    },
    {
        "id": "97430b63.1f4c88",
        "type": "function",
        "z": "20c682c8.b59efe",
        "name": "Process controls",
        "func": "if ( typeof context.days == 'undefined' ) context.days=1;\nif ( typeof context.selector == 'undefined' ) context.selector=29;\nif ( typeof context.saving == 'undefined' ) context.saving=1;\nif ( typeof context.global.timing == 'undefined' ) \n    {\n        context.global.timing=[\n                        14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n                        14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n                        14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n                        14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n                        14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n                        14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n                        14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n                        6,14\n                        ];\n        context.saving=1;                    \n    }\nvar timing=global.get(\"timing\");\n\nswitch (msg.payload)\n    {\n    case \"u\" :  if ((context.selector>4)&&(context.selector<29))\n                {\n                    timing[((context.days-1)*24)+context.selector-5]++; \n                    if (timing[((context.days-1)*24)+context.selector-5]>26){ timing[((context.days-1)*24)+context.selector-5]=26; msg.foryou=\"Limite raggiunto\";}\n                    else msg.foryou=\"Temperatura aumentata\";\n                }\n                if (context.selector==1) { if (timing[168+(context.selector-1)]<26) {  timing[168+(context.selector-1)]++; msg.foryou=\"Temperatura clima aumentata di 1°C\"; } else msg.foryou=\"Limite raggiunto\"; }\n                if (context.selector==2) { if (timing[168+(context.selector-1)]<26) {  timing[168+(context.selector-1)]++; msg.foryou=\"Temperatura fuori casa aumentata di 1°C\"; } else msg.foryou=\"Limite raggiunto\"; }\n                if (context.selector==29) { msg.foryou=\"Giorno successivo\"; context.days++; if (context.days>7) { context.days = 1; } }\n                break;\n    case \"d\" :  if ((context.selector>4)&&(context.selector<29))\n                {\n                    timing[((context.days-1)*24)+context.selector-5]--; \n                    if (timing[((context.days-1)*24)+context.selector-5]<14){ timing[((context.days-1)*24)+context.selector-5]=14; msg.foryou=\"Limite raggiunto\";}\n                    else msg.foryou=\"Temperatura decrementata\";\n                }\n                if (context.selector==1) { if (timing[168+(context.selector-1)]>12) { timing[168+(context.selector-1)]--; msg.foryou=\"Temperatura clima diminuita di 1°C\"; } else msg.foryou=\"Limite raggiunto\"; }\n                if (context.selector==2) { if (timing[168+(context.selector-1)]>12) { timing[168+(context.selector-1)]--; msg.foryou=\"Temperatura fuori casa diminuita di 1°C\"; } else msg.foryou=\"Limite raggiunto\"; }\n                if (context.selector==29) {  msg.foryou=\"Giorno precedente\";  context.days--; if (context.days < 1) { context.days = 7;  } }\n                break;\n    case 'r' :  if ((context.selector>=5)&&(context.selector<28))\n                        {\n                         timing[((context.days-1)*24)+context.selector-4]=timing[((context.days-1)*24)+context.selector-5];   \n                         context.selector++;\n                         msg.foryou=\"Temperatura copiata nello slot successivo\";\n                        }\n                if ((context.selector==29)&&(context.days<7))\n                        {\n                         for (var a=0;a<24;a++)\n                            {\n                             timing[((context.days)*24)+a]=timing[((context.days-1)*24)+a];   \n                            }\n                         context.days++;\n                         msg.foryou=\"Impostazioni copiate nel giorno successivo\";\n                        }\n                        else if(context.days==7)\n                            msg.foryou=\"Fine della settimana raggiunto!\";\n                break;\n    case 's': context.saving=0;  msg.foryou=\"Impostazioni salvate\"; break;\n    case '1':\n    case '2':\n    case '3':\n    case '4':\n    case '5':\n    case '6':\n    case '7':\n    case '8':\n    case '9':\n    case '10':\n    case '11':\n    case '12':\n    case '13':\n    case '14':\n    case '15':\n    case '16':\n    case '17':\n    case '18':\n    case '19':\n    case '20':\n    case '21':\n    case '22':\n    case '23':\n    case '24':\n    case '25':\n    case '26':\n    case '27':\n    case '28':\n    case '29': context.selector=parseInt(msg.payload);\n               if (msg.payload=='1') msg.foryou=\"Temperatura clima selezionata\"; \n               else if (msg.payload=='2') msg.foryou=\"Temperatura fuori casa selezionata\";\n               else if (msg.payload=='29') msg.foryou=\"Giorno selezionato\";\n               else  msg.foryou=\"Regolazione temperatura ore: \" + (parseInt(msg.payload)-5);\n    break;\n    case 'c' : msg.payload=\"niente\";  msg.foryou=\"Cambiamenti annullati\"; node.send([null,null,msg]);\n    }\n\nmsg.temperatures=context.temperatures;\nmsg.timing=timing;\nmsg.days=context.days;\nmsg.selector=context.selector;\n\nnode.send([msg,null,null]);\n\nif (context.saving===0) \n    { \n       msg.topic=\"\";\n        msg.timing=\"\";\n        msg.payload=JSON.stringify(timing);\n        node.send([null,msg,null]); \n        context.saving=1;\n    }\n    msg.foryou=\"\"",
        "outputs": "3",
        "noerr": 0,
        "x": 903,
        "y": 1669,
        "wires": [
            [
                "387461ec.dc158e"
            ],
            [
                "ac33e6d0.c163e8"
            ],
            [
                "8f477cbb.0b78c"
            ]
        ]
    },
    {
        "id": "aeaa17cd.6a07f8",
        "type": "inject",
        "z": "20c682c8.b59efe",
        "name": "Once only",
        "repeat": "",
        "crontab": "",
        "once": true,
        "topic": "",
        "payload": "",
        "payloadType": "str",
        "x": 688,
        "y": 1717,
        "wires": [
            [
                "97430b63.1f4c88",
                "94321f9f.323dc"
            ]
        ]
    },
    {
        "id": "bdc4da3.12a8028",
        "type": "inject",
        "z": "20c682c8.b59efe",
        "name": "Every minute",
        "repeat": "60",
        "crontab": "",
        "once": true,
        "topic": "",
        "payload": "",
        "payloadType": "str",
        "x": 661,
        "y": 1838,
        "wires": [
            [
                "aaff02d9.db667"
            ]
        ]
    },
    {
        "id": "94288cf.ccce97",
        "type": "function",
        "z": "20c682c8.b59efe",
        "name": "Process heat",
        "func": "var timing=global.get(\"timing\");\nvar now = new Date(msg.time);\nmsg.payload=timing[(now.getDay()*24)+now.getHours()];\nmsg.frost=timing[168];\nmsg.away=timing[169];\nnode.status({fill:\"blue\",shape:\"dot\",text:\"Set point \" + msg.payload + \"°C\"});\nreturn msg;\n\n",
        "outputs": 1,
        "noerr": 0,
        "x": 987,
        "y": 1838,
        "wires": [
            [
                "715747d.b57acb8"
            ]
        ]
    },
    {
        "id": "ac33e6d0.c163e8",
        "type": "file",
        "z": "20c682c8.b59efe",
        "name": "backup",
        "filename": "/home/pi/data/thermo_scheduler.log",
        "appendNewline": true,
        "createDir": true,
        "overwriteFile": "true",
        "x": 1092,
        "y": 1668,
        "wires": [
            []
        ]
    },
    {
        "id": "94321f9f.323dc",
        "type": "file in",
        "z": "20c682c8.b59efe",
        "name": "Restore",
        "filename": "/home/pi/data/thermo_scheduler.log",
        "format": "utf8",
        "x": 881,
        "y": 1747,
        "wires": [
            [
                "d9f39fdb.ade5c"
            ]
        ]
    },
    {
        "id": "d9f39fdb.ade5c",
        "type": "function",
        "z": "20c682c8.b59efe",
        "name": "Restore data from SD",
        "func": "context.global.timing=JSON.parse(msg.payload);\nmsg.payload=\"\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1081,
        "y": 1747,
        "wires": [
            [
                "720ced17.741ec4"
            ]
        ]
    },
    {
        "id": "715747d.b57acb8",
        "type": "debug",
        "z": "20c682c8.b59efe",
        "name": "",
        "active": true,
        "console": "false",
        "complete": "true",
        "x": 1158.5,
        "y": 1838,
        "wires": []
    },
    {
        "id": "db363d9e.83b29",
        "type": "inject",
        "z": "20c682c8.b59efe",
        "name": "",
        "repeat": "1",
        "crontab": "",
        "once": true,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 685,
        "y": 3317,
        "wires": [
            [
                "8ab4f286.9e135"
            ]
        ]
    },
    {
        "id": "1b39179f.d8dd28",
        "type": "ui_text",
        "z": "20c682c8.b59efe",
        "group": "f0089344.b8ed1",
        "order": 0,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "",
        "format": "{{msg.payload}}",
        "layout": "col-center",
        "x": 1079,
        "y": 3317,
        "wires": []
    },
    {
        "id": "b9bfb4a3.0cea48",
        "type": "link in",
        "z": "20c682c8.b59efe",
        "name": "restore",
        "links": [
            "8f477cbb.0b78c"
        ],
        "x": 741.5,
        "y": 1768,
        "wires": [
            [
                "94321f9f.323dc"
            ]
        ]
    },
    {
        "id": "8f477cbb.0b78c",
        "type": "link out",
        "z": "20c682c8.b59efe",
        "name": "restore",
        "links": [
            "b9bfb4a3.0cea48"
        ],
        "x": 1054.5,
        "y": 1705,
        "wires": []
    },
    {
        "id": "acc52a0d.3759b8",
        "type": "link in",
        "z": "20c682c8.b59efe",
        "name": "restoreSD",
        "links": [
            "720ced17.741ec4"
        ],
        "x": 741,
        "y": 1669,
        "wires": [
            [
                "97430b63.1f4c88"
            ]
        ]
    },
    {
        "id": "720ced17.741ec4",
        "type": "link out",
        "z": "20c682c8.b59efe",
        "name": "restoreSD",
        "links": [
            "acc52a0d.3759b8"
        ],
        "x": 1235,
        "y": 1747,
        "wires": []
    },
    {
        "id": "387461ec.dc158e",
        "type": "link out",
        "z": "20c682c8.b59efe",
        "name": "setSettings",
        "links": [
            "89be7c05.e44d8"
        ],
        "x": 1055.5,
        "y": 1629,
        "wires": []
    },
    {
        "id": "89be7c05.e44d8",
        "type": "link in",
        "z": "20c682c8.b59efe",
        "name": "setSettings",
        "links": [
            "387461ec.dc158e"
        ],
        "x": 547.5,
        "y": 1617,
        "wires": [
            [
                "dfd41566.f73768"
            ]
        ]
    },
    {
        "id": "40c5d4d9.8147ac",
        "type": "ui_template",
        "z": "20c682c8.b59efe",
        "group": "f1a9197e.2dfc88",
        "name": "Settings page",
        "order": 3,
        "width": "6",
        "height": "6",
        "format": "<script>\n\nvar thedays1=[\"DOMENICA\",\"LUNEDI\",\"MARTEDI\",\"MERCOLEDI\",\"GIOVEDI\",\"VENERDI\",\"SABATO\"];\n\nvar ID1 = \"BB\";\n\nvar last1=29;\n\nfunction stat1(text)\n{\n$(\"#info\"+ID1).text(text);\nvar tm=setTimeout(function(){ $(\"#info\"+ID1).text(\"Ok\"); clearTimeout(tm);}, 3000);\n}\n\nfunction selec1(val,sta)\n{\nvar w=\"#td\"+val+ID1;\n if (sta) $(w).css('background-color','#4CAF50'); else $(w).css('background-color','#FFC107');\n}\n\n\n    (function(scope){\n        scope.ID1 = ID1;\n        scope.send({payload: '29'})\n        scope.$watch('msg', function(msg) {\n            selec1(last1,0); last1=msg.selector; selec1(last1,1);\n            for (var x=0; x<24; x++) \n                { \n                    var w=\"#t\"+x+ID1; bar(w,msg.timing[((msg.days-1)*24)+x]); \n                    var v=\"#v\"+x+ID1; $(v).text(msg.timing[((msg.days-1)*24)+x]+\"°\")\n                } \n            for (var x=0; x<2; x++) { var w=\"#s\"+x+ID1; $(w).text(msg.timing[168+x]); }\n             $(\"#d0\"+ID1).text(thedays1[msg.days-1]);\n             if ((last1>4) &&(last1<29))\n                 $(\"#current\"+ID1).text(msg.timing[((msg.days-1)*24)+last1-5] + \"°\");\n             else\n                 $(\"#current\"+ID1).text(\"-\");\n                 \n            if (msg.foryou!=\"\") { stat1(msg.foryou);  }\n            \n             \n        });\n \n    })(scope);\n      \n\n</script>\n<table width=\"100%\">\n    \n    <tr>\n        <td colspan=24><center><span class=\"smallheadings\" >Giorno</span></center></td>\n        <!--<td colspan=3><center><span class=\"smallheadings\">Clima</span></center></td>\n        <td colspan=3><center><span class=\"smallheadings\">Fuori casa</span></center></td>-->\n    </tr>\n   \n    <tr>\n        <td ng-click=\"send({payload: '29'})\" colspan=24><center><span id=\"{{ 'd0' + ID1 }}\" style=\"cursor:pointer;color:white;font-size:120%\">LUNEDI</span></center></td>\n        <!--<td ng-click=\"send({payload: '1'})\" colspan=3><center><span id=\"s0\" style=\"color:white;font-size:120%\">14</span></center></td>\n        <td ng-click=\"send({payload: '2'})\" colspan=3><center><span id=\"s1\" style=\"color:white;font-size:120%\">20</span></center></td>-->\n    </tr>\n    \n    <tr style=\"height:2px\">\n        <td id=\"{{ 'td29' + ID1 }}\" colspan=24 style=\"background-color:#9E9E9E;height:2px;\"></td>        \n       <!-- <td id=\"td1\" colspan=3 style=\"background-color:#9E9E9E;height:2px;\"></td>\n        <td id=\"td2\" colspan=3 style=\"background-color:#9E9E9E;height:2px;\"></td>-->\n    </tr>  \n\n    <tr>\n        <td ng-click=\"send({payload: '5'})\" class=\"thedays\"><span id=\"{{ 'v0' + ID1 }}\" class=\"thetemps\"></span><div id=\"{{ 't0' + ID1 }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '6'})\" class=\"thedays\"><span id=\"{{ 'v1' + ID1 }}\" class=\"thetemps\"></span><div id=\"{{ 't1' + ID1 }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '7'})\" class=\"thedays\"><span id=\"{{ 'v2' + ID1 }}\" class=\"thetemps\"></span><div id=\"{{ 't2' + ID1 }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '8'})\" class=\"thedays\"><span id=\"{{ 'v3' + ID1 }}\" class=\"thetemps\"></span><div id=\"{{ 't3' + ID1 }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '9'})\" class=\"thedays\"><span id=\"{{ 'v4' + ID1 }}\" class=\"thetemps\"></span><div id=\"{{ 't4' + ID1 }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '10'})\" class=\"thedays\"><span id=\"{{ 'v5' + ID1 }}\" class=\"thetemps\"></span><div id=\"{{ 't5' + ID1 }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '11'})\" class=\"thedays\"><span id=\"{{ 'v6' + ID1 }}\" class=\"thetemps\"></span><div id=\"{{ 't6' + ID1 }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '12'})\" class=\"thedays\"><span id=\"{{ 'v7' + ID1 }}\" class=\"thetemps\"></span><div id=\"{{ 't7' + ID1 }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '13'})\" class=\"thedays\"><span id=\"{{ 'v8' + ID1 }}\" class=\"thetemps\"></span><div id=\"{{ 't8' + ID1 }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '14'})\" class=\"thedays\"><span id=\"{{ 'v9' + ID1 }}\" class=\"thetemps\"></span><div id=\"{{ 't9' + ID1 }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '15'})\" class=\"thedays\"><span id=\"{{ 'v10' + ID1 }}\" class=\"thetemps\"></span><div id=\"{{ 't10' + ID1 }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '16'})\" class=\"thedays\"><span id=\"{{ 'v11' + ID1 }}\" class=\"thetemps\"></span><div id=\"{{ 't11' + ID1 }}\" class=\"theblocks\"></div></td>\n    </tr>  \n    \n    <tr style=\"height:2px\">\n        <td id=\"{{ 'td5' + ID1 }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td6' + ID1 }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td7' + ID1 }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td8' + ID1 }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td9' + ID1 }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td10' + ID1 }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td11' + ID1 }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td12' + ID1 }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td13' + ID1 }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td14' + ID1 }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td15' + ID1 }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td16' + ID1 }}\" class=\"the2px\"></td>\n    </tr>   \n    \n    <tr>\n        <td align=\"center\">0</td>\n        <td align=\"center\">1</td>\n        <td align=\"center\">2</td>\n        <td align=\"center\">3</td>\n        <td align=\"center\">4</td>\n        <td align=\"center\">5</td>\n        <td align=\"center\">6</td>\n        <td align=\"center\">7</td>\n        <td align=\"center\">8</td>\n        <td align=\"center\">9</td>\n        <td align=\"center\">10</td>\n        <td align=\"center\">11</td>\n    </tr> \n    \n    <tr>\n        <td ng-click=\"send({payload: '17'})\" class=\"thedays\"><span id=\"{{ 'v12' + ID1 }}\" class=\"thetemps\"></span><div id=\"{{ 't12' + ID1 }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '18'})\" class=\"thedays\"><span id=\"{{ 'v13' + ID1 }}\" class=\"thetemps\"></span><div id=\"{{ 't13' + ID1 }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '19'})\" class=\"thedays\"><span id=\"{{ 'v14' + ID1 }}\" class=\"thetemps\"></span><div id=\"{{ 't14' + ID1 }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '20'})\" class=\"thedays\"><span id=\"{{ 'v15' + ID1 }}\" class=\"thetemps\"></span><div id=\"{{ 't15' + ID1 }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '21'})\" class=\"thedays\"><span id=\"{{ 'v16' + ID1 }}\" class=\"thetemps\"></span><div id=\"{{ 't16' + ID1 }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '22'})\" class=\"thedays\"><span id=\"{{ 'v17' + ID1 }}\" class=\"thetemps\"></span><div id=\"{{ 't17' + ID1 }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '23'})\" class=\"thedays\"><span id=\"{{ 'v18' + ID1 }}\" class=\"thetemps\"></span><div id=\"{{ 't18' + ID1 }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '24'})\" class=\"thedays\"><span id=\"{{ 'v19' + ID1 }}\" class=\"thetemps\"></span><div id=\"{{ 't19' + ID1 }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '25'})\" class=\"thedays\"><span id=\"{{ 'v20' + ID1 }}\" class=\"thetemps\"></span><div id=\"{{ 't20' + ID1 }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '26'})\" class=\"thedays\"><span id=\"{{ 'v21' + ID1 }}\" class=\"thetemps\"></span><div id=\"{{ 't21' + ID1 }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '27'})\" class=\"thedays\"><span id=\"{{ 'v22' + ID1 }}\" class=\"thetemps\"></span><div id=\"{{ 't22' + ID1 }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '28'})\" class=\"thedays\"><span id=\"{{ 'v23' + ID1 }}\" class=\"thetemps\"></span><div id=\"{{ 't23' + ID1 }}\" class=\"theblocks\"></div></td>\n    </tr>  \n    \n    <tr style=\"height:2px\">\n        <td id=\"{{ 'td17' + ID1 }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td18' + ID1 }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td19' + ID1 }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td20' + ID1 }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td21' + ID1 }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td22' + ID1 }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td23' + ID1 }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td24' + ID1 }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td25' + ID1 }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td26' + ID1 }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td27' + ID1 }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td28' + ID1 }}\" class=\"the2px\"></td>\n    </tr>  \n    \n    <tr>\n        <td align=\"center\">12</td>\n        <td align=\"center\">13</td>\n        <td align=\"center\">14</td>\n        <td align=\"center\">15</td>\n        <td align=\"center\">16</td>\n        <td align=\"center\">17</td>\n        <td align=\"center\">18</td>\n        <td align=\"center\">19</td>\n        <td align=\"center\">20</td>\n        <td align=\"center\">21</td>\n        <td align=\"center\">22</td>\n        <td align=\"center\">23</td>\n    </tr> \n    \n    <tr height=\"20px\">\n        <td colspan=2 class=\"smallheadings\">Azioni:</td>\n\n        <td colspan=10 ><center><span id=\"{{ 'info' + ID1 }}\" class=\"smallheadings\" ></span></center></td>\n\n    </tr>\n    \n    <tr height=\"10px\">\n        <td colspan=\"12\"></td>\n    </tr>\n\n    <tr style=\"height:48px\">\n        <td colspan=2>\n            <button class=\"vibrate filled touched smallfont rounded greybuttons\" ng-click=\"send({payload: 'd'})\"> \n               <ng-md-icon style=\"color: #fff;\" icon=\"keyboard_arrow_down\">\n                    <md-tooltip md-direction=\"bottom\">DECREMENTA</md-tooltip>\n                </ng-md-icon>\n            </button> \n        </td>\n        \n        <td colspan=2><center><span id=\"{{ 'current' + ID1 }}\" style=\"color:white;font-size:120%\">-</span></center></td>\n\n        <td colspan=2>\n            <button class=\"vibrate filled touched smallfont rounded greybuttons\" ng-click=\"send({payload: 'u'})\"> \n               <ng-md-icon style=\"color: #fff;\" icon=\"keyboard_arrow_up\">\n                    <md-tooltip md-direction=\"bottom\">INCREMENTA</md-tooltip>\n                </ng-md-icon>\n            </button> \n        </td>\n\n        <td colspan=2>\n            <button class=\"vibrate filled touched smallfont rounded greybuttons\" ng-click=\"send({payload: 'r'})\"> \n               <ng-md-icon style=\"color: #fff;\" icon=\"content_copy\">\n                    <md-tooltip md-direction=\"bottom\">COPIA</md-tooltip>\n                </ng-md-icon>\n            </button> \n        </td>\n\n\n        <td colspan=2>\n            <button class=\"vibrate filled touched smallfont rounded greybuttons\" ng-click=\"send({payload: 's'})\"> \n                 <ng-md-icon style=\"color: #fff;\" icon=\"save\">\n                    <md-tooltip md-direction=\"bottom\">SALVA</md-tooltip>\n                </ng-md-icon>\n            </button> \n        </td>\n\n        <td colspan=2>\n            <button class=\"vibrate filled touched smallfont rounded greybuttons\"  ng-click=\"send({payload: 'c'})\"> \n                 <ng-md-icon style=\"color: #fff;\" icon=\"cancel\">\n                    <md-tooltip md-direction=\"bottom\">ANNULLA</md-tooltip>\n                </ng-md-icon>\n            </button> \n        </td>\n        <td colspan=1></td>\n    </tr>\n\n</table>",
        "storeOutMessages": false,
        "fwdInMessages": false,
        "x": 770,
        "y": 1978,
        "wires": [
            [
                "6c91d28d.6473fc"
            ]
        ]
    },
    {
        "id": "6c91d28d.6473fc",
        "type": "function",
        "z": "20c682c8.b59efe",
        "name": "Process controls",
        "func": "if ( typeof context.days1 == 'undefined' ) context.days1=1;\nif ( typeof context.selector1 == 'undefined' ) context.selector1=29;\nif ( typeof context.saving1 == 'undefined' ) context.saving1=1;\nif ( typeof context.global.timing1 == 'undefined' ) \n    {\n        context.global.timing1=[\n                        14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n                        14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n                        14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n                        14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n                        14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n                        14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n                        14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n                        6,14\n                        ];\n        context.saving1=1;                    \n    }\nvar timing1=global.get(\"timing1\");\n\nswitch (msg.payload)\n    {\n    case \"u\" :  if ((context.selector1>4)&&(context.selector1<29))\n                {\n                    timing1[((context.days1-1)*24)+context.selector1-5]++; \n                    if (timing1[((context.days1-1)*24)+context.selector1-5]>26){ timing1[((context.days1-1)*24)+context.selector1-5]=26; msg.foryou=\"Limite raggiunto\";}\n                    else msg.foryou=\"Temperatura aumentata\";\n                }\n                if (context.selector1==1) { if (timing1[168+(context.selector1-1)]<26) {  timing1[168+(context.selector1-1)]++; msg.foryou=\"Temperatura clima aumentata di 1°C\"; } else msg.foryou=\"Limite raggiunto\"; }\n                if (context.selector1==2) { if (timing1[168+(context.selector1-1)]<26) {  timing1[168+(context.selector1-1)]++; msg.foryou=\"Temperatura fuori casa aumentata di 1°C\"; } else msg.foryou=\"Limite raggiunto\"; }\n                if (context.selector1==29) { msg.foryou=\"Giorno successivo\"; context.days1++; if (context.days1>7) { context.days1 = 1; } }\n                break;\n    case \"d\" :  if ((context.selector1>4)&&(context.selector1<29))\n                {\n                    timing1[((context.days1-1)*24)+context.selector1-5]--; \n                    if (timing1[((context.days1-1)*24)+context.selector1-5]<14){ timing1[((context.days1-1)*24)+context.selector1-5]=14; msg.foryou=\"Limite raggiunto\";}\n                    else msg.foryou=\"Temperatura decrementata\";\n                }\n                if (context.selector1==1) { if (timing1[168+(context.selector1-1)]>12) { timing1[168+(context.selector1-1)]--; msg.foryou=\"Temperatura clima diminuita di 1°C\"; } else msg.foryou=\"Limite raggiunto\"; }\n                if (context.selector1==2) { if (timing1[168+(context.selector1-1)]>12) { timing1[168+(context.selector1-1)]--; msg.foryou=\"Temperatura fuori casa diminuita di 1°C\"; } else msg.foryou=\"Limite raggiunto\"; }\n                if (context.selector1==29) {  msg.foryou=\"Giorno precedente\";  context.days1--; if (context.days1 < 1) { context.days1 = 7;  } }\n                break;\n    case 'r' :  if ((context.selector1>=5)&&(context.selector1<28))\n                        {\n                         timing1[((context.days1-1)*24)+context.selector1-4]=timing1[((context.days1-1)*24)+context.selector1-5];   \n                         context.selector1++;\n                         msg.foryou=\"Temperatura copiata nello slot successivo\";\n                        }\n                if ((context.selector1==29)&&(context.days1<7))\n                        {\n                         for (var a=0;a<24;a++)\n                            {\n                             timing1[((context.days1)*24)+a]=timing1[((context.days1-1)*24)+a];   \n                            }\n                         context.days1++;\n                         msg.foryou=\"Impostazioni copiate nel giorno successivo\";\n                        }\n                        else if(context.days1==7)\n                            msg.foryou=\"Fine della settimana raggiunto!\";\n                break;\n    case 's': context.saving1=0;  msg.foryou=\"Impostazioni salvate\"; break;\n    case '1':\n    case '2':\n    case '3':\n    case '4':\n    case '5':\n    case '6':\n    case '7':\n    case '8':\n    case '9':\n    case '10':\n    case '11':\n    case '12':\n    case '13':\n    case '14':\n    case '15':\n    case '16':\n    case '17':\n    case '18':\n    case '19':\n    case '20':\n    case '21':\n    case '22':\n    case '23':\n    case '24':\n    case '25':\n    case '26':\n    case '27':\n    case '28':\n    case '29': context.selector1=parseInt(msg.payload);\n               if (msg.payload=='1') msg.foryou=\"Temperatura clima selezionata\"; \n               else if (msg.payload=='2') msg.foryou=\"Temperatura fuori casa selezionata\";\n               else if (msg.payload=='29') msg.foryou=\"Giorno selezionato\";\n               else  msg.foryou=\"Regolazione temperatura ore: \" + (parseInt(msg.payload)-5);\n    break;\n    case 'c' : msg.payload=\"niente\";  msg.foryou=\"Cambiamenti annullati\"; node.send([null,null,msg]);\n    }\n\nmsg.temperatures=context.temperatures1;\nmsg.timing=timing1;\nmsg.days=context.days1;\nmsg.selector=context.selector1;\n\nnode.send([msg,null,null]);\n\nif (context.saving1===0) \n    { \n       msg.topic=\"\";\n        msg.timing=\"\";\n        msg.payload=JSON.stringify(timing1);\n        node.send([null,msg,null]); \n        context.saving1=1;\n    }\n    msg.foryou=\"\"",
        "outputs": "3",
        "noerr": 0,
        "x": 993,
        "y": 2030,
        "wires": [
            [
                "16c0ac56.9a2ed4"
            ],
            [
                "c97434d.a8464c8"
            ],
            [
                "5302156.ac6a2ec"
            ]
        ]
    },
    {
        "id": "1508de6a.35bb12",
        "type": "inject",
        "z": "20c682c8.b59efe",
        "name": "Once only",
        "repeat": "",
        "crontab": "",
        "once": true,
        "topic": "",
        "payload": "",
        "payloadType": "str",
        "x": 778,
        "y": 2078,
        "wires": [
            [
                "6c91d28d.6473fc",
                "fc5e38b7.19d788"
            ]
        ]
    },
    {
        "id": "9ef84222.f606",
        "type": "inject",
        "z": "20c682c8.b59efe",
        "name": "Every minute",
        "repeat": "60",
        "crontab": "",
        "once": true,
        "topic": "",
        "payload": "",
        "payloadType": "str",
        "x": 751,
        "y": 2199,
        "wires": [
            [
                "4bec742d.96ebdc"
            ]
        ]
    },
    {
        "id": "cc0da780.529c58",
        "type": "function",
        "z": "20c682c8.b59efe",
        "name": "Process heat",
        "func": "var timing=global.get(\"timing1\");\nvar now = new Date(msg.time);\nmsg.payload=timing[(now.getDay()*24)+now.getHours()];\nmsg.frost=timing[168];\nmsg.away=timing[169];\nnode.status({fill:\"blue\",shape:\"dot\",text:\"Set point \" + msg.payload + \"°C\"});\nreturn msg;\n\n",
        "outputs": 1,
        "noerr": 0,
        "x": 1079,
        "y": 2198,
        "wires": [
            [
                "6664655c.f1d2ac"
            ]
        ]
    },
    {
        "id": "c97434d.a8464c8",
        "type": "file",
        "z": "20c682c8.b59efe",
        "name": "backup",
        "filename": "/home/pi/data/thermo_scheduler_01.log",
        "appendNewline": true,
        "createDir": true,
        "overwriteFile": "true",
        "x": 1182,
        "y": 2029,
        "wires": [
            []
        ]
    },
    {
        "id": "fc5e38b7.19d788",
        "type": "file in",
        "z": "20c682c8.b59efe",
        "name": "Restore",
        "filename": "/home/pi/data/thermo_scheduler_01.log",
        "format": "utf8",
        "x": 971,
        "y": 2108,
        "wires": [
            [
                "e718c2e.140e14"
            ]
        ]
    },
    {
        "id": "e718c2e.140e14",
        "type": "function",
        "z": "20c682c8.b59efe",
        "name": "Restore data from SD",
        "func": "context.global.timing1=JSON.parse(msg.payload);\nmsg.payload=\"\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1171,
        "y": 2108,
        "wires": [
            [
                "e0eb3d1a.8cc7"
            ]
        ]
    },
    {
        "id": "6664655c.f1d2ac",
        "type": "debug",
        "z": "20c682c8.b59efe",
        "name": "",
        "active": true,
        "console": "false",
        "complete": "true",
        "x": 1247.5,
        "y": 2199,
        "wires": []
    },
    {
        "id": "ef623152.281ea",
        "type": "link in",
        "z": "20c682c8.b59efe",
        "name": "restore",
        "links": [
            "5302156.ac6a2ec"
        ],
        "x": 831.5,
        "y": 2129,
        "wires": [
            [
                "fc5e38b7.19d788"
            ]
        ]
    },
    {
        "id": "5302156.ac6a2ec",
        "type": "link out",
        "z": "20c682c8.b59efe",
        "name": "restore",
        "links": [
            "ef623152.281ea"
        ],
        "x": 1144.5,
        "y": 2066,
        "wires": []
    },
    {
        "id": "9b26a901.c7ff98",
        "type": "link in",
        "z": "20c682c8.b59efe",
        "name": "restoreSD",
        "links": [
            "e0eb3d1a.8cc7"
        ],
        "x": 831,
        "y": 2030,
        "wires": [
            [
                "6c91d28d.6473fc"
            ]
        ]
    },
    {
        "id": "e0eb3d1a.8cc7",
        "type": "link out",
        "z": "20c682c8.b59efe",
        "name": "restoreSD",
        "links": [
            "9b26a901.c7ff98"
        ],
        "x": 1325,
        "y": 2108,
        "wires": []
    },
    {
        "id": "16c0ac56.9a2ed4",
        "type": "link out",
        "z": "20c682c8.b59efe",
        "name": "setSettings",
        "links": [
            "7feeac82.1b8a14"
        ],
        "x": 1145.5,
        "y": 1990,
        "wires": []
    },
    {
        "id": "7feeac82.1b8a14",
        "type": "link in",
        "z": "20c682c8.b59efe",
        "name": "setSettings",
        "links": [
            "16c0ac56.9a2ed4"
        ],
        "x": 637.5,
        "y": 1978,
        "wires": [
            [
                "40c5d4d9.8147ac"
            ]
        ]
    },
    {
        "id": "704b3b45.1f3124",
        "type": "ui_template",
        "z": "20c682c8.b59efe",
        "group": "f59caa4c.0eb048",
        "name": "Settings page",
        "order": 3,
        "width": "6",
        "height": "6",
        "format": "<script>\n\nvar thedays_0=[\"DOMENICA\",\"LUNEDI\",\"MARTEDI\",\"MERCOLEDI\",\"GIOVEDI\",\"VENERDI\",\"SABATO\"];\n\nvar ID_0 = \"DD\";\n\nvar last_0=29;\n\nfunction on_off(mm,val)\n{\nif (val==0) { $(mm).height(\"30%\"); $(mm).css('background-color', '#f44336'); } //green\nif (val==1) { $(mm).height(\"60%\"); $(mm).css('background-color', '#4CAF50'); } //green\n}\n\nfunction feedback(text)\n{\n$(\"#info\"+ID_0).text(text);\nvar tm=setTimeout(function(){ $(\"#info\"+ID_0).text(\"Ok\"); clearTimeout(tm);}, 3000);\n}\n\nfunction selec_0(val,sta)\n{\nvar w=\"#td\"+val+ID_0;\n if (sta) $(w).css('background-color','#4CAF50'); else $(w).css('background-color','#FFC107');\n}\n\n\n    (function(scope){\n        scope.ID_0 = ID_0;\n        scope.send({payload: '29'})\n        scope.$watch('msg', function(msg) {\n            selec_0(last_0,0); last_0=msg.selector; selec_0(last_0,1);\n            for (var x=0; x<24; x++) \n                { \n                    var w=\"#t\"+x+ID_0; on_off(w,msg.timing[((msg.days-1)*24)+x]); \n                    var v=\"#v\"+x+ID_0; $(v).text(msg.timing[((msg.days-1)*24)+x] == 0 ? 'Off' : 'On')\n                } \n            for (var x=0; x<2; x++) { var w=\"#s\"+x+ID_0; $(w).text(msg.timing[168+x]); }\n             $(\"#d0\"+ID_0).text(thedays_0[msg.days-1]);\n             if ((last_0>4) &&(last_0<29))\n                 $(\"#current\"+ID_0).text(msg.timing[((msg.days-1)*24)+last_0-5]  == 0 ? 'Off' : 'On');\n             else\n                 $(\"#current\"+ID_0).text(\"-\");\n                 \n            if (msg.foryou!=\"\") { feedback(msg.foryou);  }\n            \n             \n        });\n \n    })(scope);\n      \n\n</script>\n<table width=\"100%\">\n    \n    <tr>\n        <td colspan=24><center><span class=\"smallheadings\" >Giorno</span></center></td>\n        <!--<td colspan=3><center><span class=\"smallheadings\">Clima</span></center></td>\n        <td colspan=3><center><span class=\"smallheadings\">Fuori casa</span></center></td>-->\n    </tr>\n   \n    <tr>\n        <td ng-click=\"send({payload: '29'})\" colspan=24><center><span id=\"{{ 'd0' + ID_0 }}\" style=\"cursor:pointer;color:white;font-size:120%\">LUNEDI</span></center></td>\n        <!--<td ng-click=\"send({payload: '1'})\" colspan=3><center><span id=\"s0\" style=\"color:white;font-size:120%\">14</span></center></td>\n        <td ng-click=\"send({payload: '2'})\" colspan=3><center><span id=\"s1\" style=\"color:white;font-size:120%\">20</span></center></td>-->\n    </tr>\n    \n    <tr style=\"height:2px\">\n        <td id=\"{{ 'td29' + ID_0 }}\" colspan=24 style=\"background-color:#9E9E9E;height:2px;\"></td>        \n       <!-- <td id=\"td1\" colspan=3 style=\"background-color:#9E9E9E;height:2px;\"></td>\n        <td id=\"td2\" colspan=3 style=\"background-color:#9E9E9E;height:2px;\"></td>-->\n    </tr>  \n\n    <tr>\n        <td ng-click=\"send({payload: '5'})\" class=\"thedays\"><span id=\"{{ 'v0' + ID_0 }}\" class=\"thetemps\"></span><div id=\"{{ 't0' + ID_0 }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '6'})\" class=\"thedays\"><span id=\"{{ 'v1' + ID_0 }}\" class=\"thetemps\"></span><div id=\"{{ 't1' + ID_0 }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '7'})\" class=\"thedays\"><span id=\"{{ 'v2' + ID_0 }}\" class=\"thetemps\"></span><div id=\"{{ 't2' + ID_0 }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '8'})\" class=\"thedays\"><span id=\"{{ 'v3' + ID_0 }}\" class=\"thetemps\"></span><div id=\"{{ 't3' + ID_0 }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '9'})\" class=\"thedays\"><span id=\"{{ 'v4' + ID_0 }}\" class=\"thetemps\"></span><div id=\"{{ 't4' + ID_0 }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '10'})\" class=\"thedays\"><span id=\"{{ 'v5' + ID_0 }}\" class=\"thetemps\"></span><div id=\"{{ 't5' + ID_0 }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '11'})\" class=\"thedays\"><span id=\"{{ 'v6' + ID_0 }}\" class=\"thetemps\"></span><div id=\"{{ 't6' + ID_0 }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '12'})\" class=\"thedays\"><span id=\"{{ 'v7' + ID_0 }}\" class=\"thetemps\"></span><div id=\"{{ 't7' + ID_0 }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '13'})\" class=\"thedays\"><span id=\"{{ 'v8' + ID_0 }}\" class=\"thetemps\"></span><div id=\"{{ 't8' + ID_0 }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '14'})\" class=\"thedays\"><span id=\"{{ 'v9' + ID_0 }}\" class=\"thetemps\"></span><div id=\"{{ 't9' + ID_0 }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '15'})\" class=\"thedays\"><span id=\"{{ 'v10' + ID_0 }}\" class=\"thetemps\"></span><div id=\"{{ 't10' + ID_0 }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '16'})\" class=\"thedays\"><span id=\"{{ 'v11' + ID_0 }}\" class=\"thetemps\"></span><div id=\"{{ 't11' + ID_0 }}\" class=\"theblocks\"></div></td>\n    </tr>  \n    \n    <tr style=\"height:2px\">\n        <td id=\"{{ 'td5' + ID_0 }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td6' + ID_0 }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td7' + ID_0 }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td8' + ID_0 }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td9' + ID_0 }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td10' + ID_0 }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td11' + ID_0 }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td12' + ID_0 }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td13' + ID_0 }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td14' + ID_0 }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td15' + ID_0 }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td16' + ID_0 }}\" class=\"the2px\"></td>\n    </tr>   \n    \n    <tr>\n        <td align=\"center\">0</td>\n        <td align=\"center\">1</td>\n        <td align=\"center\">2</td>\n        <td align=\"center\">3</td>\n        <td align=\"center\">4</td>\n        <td align=\"center\">5</td>\n        <td align=\"center\">6</td>\n        <td align=\"center\">7</td>\n        <td align=\"center\">8</td>\n        <td align=\"center\">9</td>\n        <td align=\"center\">10</td>\n        <td align=\"center\">11</td>\n    </tr> \n    \n    <tr>\n        <td ng-click=\"send({payload: '17'})\" class=\"thedays\"><span id=\"{{ 'v12' + ID_0 }}\" class=\"thetemps\"></span><div id=\"{{ 't12' + ID_0 }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '18'})\" class=\"thedays\"><span id=\"{{ 'v13' + ID_0 }}\" class=\"thetemps\"></span><div id=\"{{ 't13' + ID_0 }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '19'})\" class=\"thedays\"><span id=\"{{ 'v14' + ID_0 }}\" class=\"thetemps\"></span><div id=\"{{ 't14' + ID_0 }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '20'})\" class=\"thedays\"><span id=\"{{ 'v15' + ID_0 }}\" class=\"thetemps\"></span><div id=\"{{ 't15' + ID_0 }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '21'})\" class=\"thedays\"><span id=\"{{ 'v16' + ID_0 }}\" class=\"thetemps\"></span><div id=\"{{ 't16' + ID_0 }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '22'})\" class=\"thedays\"><span id=\"{{ 'v17' + ID_0 }}\" class=\"thetemps\"></span><div id=\"{{ 't17' + ID_0 }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '23'})\" class=\"thedays\"><span id=\"{{ 'v18' + ID_0 }}\" class=\"thetemps\"></span><div id=\"{{ 't18' + ID_0 }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '24'})\" class=\"thedays\"><span id=\"{{ 'v19' + ID_0 }}\" class=\"thetemps\"></span><div id=\"{{ 't19' + ID_0 }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '25'})\" class=\"thedays\"><span id=\"{{ 'v20' + ID_0 }}\" class=\"thetemps\"></span><div id=\"{{ 't20' + ID_0 }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '26'})\" class=\"thedays\"><span id=\"{{ 'v21' + ID_0 }}\" class=\"thetemps\"></span><div id=\"{{ 't21' + ID_0 }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '27'})\" class=\"thedays\"><span id=\"{{ 'v22' + ID_0 }}\" class=\"thetemps\"></span><div id=\"{{ 't22' + ID_0 }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '28'})\" class=\"thedays\"><span id=\"{{ 'v23' + ID_0 }}\" class=\"thetemps\"></span><div id=\"{{ 't23' + ID_0 }}\" class=\"theblocks\"></div></td>\n    </tr>  \n    \n    <tr style=\"height:2px\">\n        <td id=\"{{ 'td17' + ID_0 }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td18' + ID_0 }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td19' + ID_0 }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td20' + ID_0 }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td21' + ID_0 }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td22' + ID_0 }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td23' + ID_0 }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td24' + ID_0 }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td25' + ID_0 }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td26' + ID_0 }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td27' + ID_0 }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td28' + ID_0 }}\" class=\"the2px\"></td>\n    </tr>  \n    \n    <tr>\n        <td align=\"center\">12</td>\n        <td align=\"center\">13</td>\n        <td align=\"center\">14</td>\n        <td align=\"center\">15</td>\n        <td align=\"center\">16</td>\n        <td align=\"center\">17</td>\n        <td align=\"center\">18</td>\n        <td align=\"center\">19</td>\n        <td align=\"center\">20</td>\n        <td align=\"center\">21</td>\n        <td align=\"center\">22</td>\n        <td align=\"center\">23</td>\n    </tr> \n    \n    <tr height=\"20px\">\n        <td colspan=2 class=\"smallheadings\">Azioni:</td>\n\n        <td colspan=10 ><center><span id=\"{{ 'info' + ID_0 }}\" class=\"smallheadings\" ></span></center></td>\n\n    </tr>\n    \n    <tr height=\"10px\">\n        <td colspan=\"12\"></td>\n    </tr>\n\n    <tr style=\"height:48px\">\n        <td colspan=2>\n            <button class=\"vibrate filled touched smallfont rounded greybuttons\" ng-click=\"send({payload: 'd'})\"> \n               <ng-md-icon style=\"color: #fff;\" icon=\"keyboard_arrow_down\"></ng-md-icon>\n            </button> \n        </td>\n        \n        <td colspan=2><center><span id=\"{{ 'current' + ID_0 }}\" style=\"color:white;font-size:120%\">-</span></center></td>\n\n        <td colspan=2>\n            <button class=\"vibrate filled touched smallfont rounded greybuttons\" ng-click=\"send({payload: 'u'})\"> \n               <ng-md-icon style=\"color: #fff;\" icon=\"keyboard_arrow_up\"></ng-md-icon>\n            </button> \n        </td>\n\n        <td colspan=2>\n            <button class=\"vibrate filled touched smallfont rounded greybuttons\" ng-click=\"send({payload: 'r'})\"> \n               <ng-md-icon style=\"color: #fff;\" icon=\"content_copy\">\n                    <md-tooltip md-direction=\"bottom\">COPIA</md-tooltip>\n                </ng-md-icon>\n            </button> \n        </td>\n\n\n        <td colspan=2>\n            <button class=\"vibrate filled touched smallfont rounded greybuttons\" ng-click=\"send({payload: 's'})\"> \n                 <ng-md-icon style=\"color: #fff;\" icon=\"save\">\n                    <md-tooltip md-direction=\"bottom\">SALVA</md-tooltip>\n                </ng-md-icon>\n            </button> \n        </td>\n\n        <td colspan=2>\n            <button class=\"vibrate filled touched smallfont rounded greybuttons\"  ng-click=\"send({payload: 'c'})\"> \n                 <ng-md-icon style=\"color: #fff;\" icon=\"cancel\">\n                    <md-tooltip md-direction=\"bottom\">ANNULLA</md-tooltip>\n                </ng-md-icon>\n            </button> \n        </td>\n        <td colspan=1></td>\n    </tr>\n\n</table>",
        "storeOutMessages": false,
        "fwdInMessages": false,
        "x": 828,
        "y": 2813,
        "wires": [
            [
                "bf082093.4c803"
            ]
        ]
    },
    {
        "id": "bf082093.4c803",
        "type": "function",
        "z": "20c682c8.b59efe",
        "name": "Process controls",
        "func": "if ( typeof context.days_0 == 'undefined' ) context.days_0=1;\nif ( typeof context.selector_0 == 'undefined' ) context.selector_0=29;\nif ( typeof context.saving_0 == 'undefined' ) context.saving_0=1;\nif ( typeof context.global.timing_0 == 'undefined' ) \n    {\n        context.global.timing_0=[\n                        1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,\n                        1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,\n                        1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,\n                        1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,\n                        1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,\n                        1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,\n                        1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,\n                        6,1\n                        ];\n        context.saving_0=1;                    \n    }\nvar timing_0=global.get(\"timing_0\");\n\nswitch (msg.payload)\n    {\n    case \"u\" :  if ((context.selector_0>4)&&(context.selector_0<29))\n                {\n                    timing_0[((context.days_0-1)*24)+context.selector_0-5] = 1; \n                    msg.foryou=\"ON\";\n                }\n                if (context.selector_0==29) { msg.foryou=\"Giorno successivo\"; context.days_0++; if (context.days_0>7) { context.days_0 = 1; } }\n                break;\n    case \"d\" :  if ((context.selector_0>4)&&(context.selector_0<29))\n                {\n                    timing_0[((context.days_0-1)*24)+context.selector_0-5] = 0; \n                    msg.foryou=\"OFF\";\n                }\n                if (context.selector_0==29) {  msg.foryou=\"Giorno precedente\";  context.days_0--; if (context.days_0 < 1) { context.days_0 = 7;  } }\n                break;\n    case 'r' :  if ((context.selector_0>=5)&&(context.selector_0<28))\n                        {\n                         timing_0[((context.days_0-1)*24)+context.selector_0-4]=timing_0[((context.days_0-1)*24)+context.selector_0-5];   \n                         context.selector_0++;\n                         msg.foryou=\"Valore copiato nello slot successivo\";\n                        }\n                if ((context.selector_0==29)&&(context.days_0<7))\n                        {\n                         for (var a=0;a<24;a++)\n                            {\n                             timing_0[((context.days_0)*24)+a]=timing_0[((context.days_0-1)*24)+a];   \n                            }\n                         context.days_0++;\n                         msg.foryou=\"Impostazioni copiate nel giorno successivo\";\n                        }\n                        else if(context.days_0==7)\n                            msg.foryou=\"Fine della settimana raggiunto!\";\n                break;\n    case 's': context.saving_0=0;  msg.foryou=\"Impostazioni salvate\"; break;\n    case '1':\n    case '2':\n    case '3':\n    case '4':\n    case '5':\n    case '6':\n    case '7':\n    case '8':\n    case '9':\n    case '10':\n    case '11':\n    case '12':\n    case '13':\n    case '1':\n    case '15':\n    case '16':\n    case '17':\n    case '18':\n    case '19':\n    case '20':\n    case '21':\n    case '22':\n    case '23':\n    case '24':\n    case '25':\n    case '26':\n    case '27':\n    case '28':\n    case '29': context.selector_0=parseInt(msg.payload);\n               if (msg.payload=='29') msg.foryou=\"Giorno selezionato\";\n               else  msg.foryou=\"Regolazione accensione ore: \" + (parseInt(msg.payload)-5);\n    break;\n    case 'c' : msg.payload=\"niente\";  msg.foryou=\"Cambiamenti annullati\"; node.send([null,null,msg]);\n    }\n\nmsg.temperatures=context.temperatures_0;\nmsg.timing=timing_0;\nmsg.days=context.days_0;\nmsg.selector=context.selector_0;\n\nnode.send([msg,null,null]);\n\nif (context.saving_0===0) \n    { \n       msg.topic=\"\";\n        msg.timing=\"\";\n        msg.payload=JSON.stringify(timing_0);\n        node.send([null,msg,null]); \n        context.saving_0=1;\n    }\n    msg.foryou=\"\"",
        "outputs": "3",
        "noerr": 0,
        "x": 1051,
        "y": 2865,
        "wires": [
            [
                "c6aaaa97.9d2138"
            ],
            [
                "7bdd4a33.21f714"
            ],
            [
                "464ee351.ba883c"
            ]
        ]
    },
    {
        "id": "57a2d99b.9d1e28",
        "type": "inject",
        "z": "20c682c8.b59efe",
        "name": "Once only",
        "repeat": "",
        "crontab": "",
        "once": true,
        "topic": "",
        "payload": "",
        "payloadType": "str",
        "x": 836,
        "y": 2913,
        "wires": [
            [
                "bf082093.4c803",
                "96a337ab.9dd208"
            ]
        ]
    },
    {
        "id": "b183782e.cfa588",
        "type": "inject",
        "z": "20c682c8.b59efe",
        "name": "Every minute",
        "repeat": "60",
        "crontab": "",
        "once": true,
        "topic": "",
        "payload": "",
        "payloadType": "str",
        "x": 809,
        "y": 3034,
        "wires": [
            [
                "49c192d2.21910c"
            ]
        ]
    },
    {
        "id": "c2b276d.3897a88",
        "type": "function",
        "z": "20c682c8.b59efe",
        "name": "Process heat",
        "func": "var timing=global.get(\"timing_0\");\nvar now = new Date(msg.time);\nmsg.payload=timing[(now.getDay()*24)+now.getHours()];\nmsg.frost=timing[168];\nmsg.away=timing[169];\nnode.status({fill:\"blue\",shape:\"dot\",text: \"State: \" + msg.payload === 0 ? 'OFF' : 'ON'});\nreturn msg;\n\n",
        "outputs": 1,
        "noerr": 0,
        "x": 1137,
        "y": 3033,
        "wires": [
            [
                "b7707faa.ba896"
            ]
        ]
    },
    {
        "id": "7bdd4a33.21f714",
        "type": "file",
        "z": "20c682c8.b59efe",
        "name": "backup",
        "filename": "/home/pi/data/on_off_scheduler.log",
        "appendNewline": true,
        "createDir": true,
        "overwriteFile": "true",
        "x": 1240,
        "y": 2864,
        "wires": [
            []
        ]
    },
    {
        "id": "96a337ab.9dd208",
        "type": "file in",
        "z": "20c682c8.b59efe",
        "name": "Restore",
        "filename": "/home/pi/data/on_off_scheduler.log",
        "format": "utf8",
        "x": 1029,
        "y": 2943,
        "wires": [
            [
                "e527a20a.4449a"
            ]
        ]
    },
    {
        "id": "e527a20a.4449a",
        "type": "function",
        "z": "20c682c8.b59efe",
        "name": "Restore data from SD",
        "func": "context.global.timing_0=JSON.parse(msg.payload);\nmsg.payload=\"\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1229,
        "y": 2943,
        "wires": [
            [
                "fb292dd6.88b8d"
            ]
        ]
    },
    {
        "id": "b7707faa.ba896",
        "type": "debug",
        "z": "20c682c8.b59efe",
        "name": "",
        "active": true,
        "console": "false",
        "complete": "true",
        "x": 1306.5,
        "y": 3033,
        "wires": []
    },
    {
        "id": "603e1325.49d4ec",
        "type": "link in",
        "z": "20c682c8.b59efe",
        "name": "restore",
        "links": [
            "464ee351.ba883c"
        ],
        "x": 889.5,
        "y": 2964,
        "wires": [
            [
                "96a337ab.9dd208"
            ]
        ]
    },
    {
        "id": "464ee351.ba883c",
        "type": "link out",
        "z": "20c682c8.b59efe",
        "name": "restore",
        "links": [
            "603e1325.49d4ec"
        ],
        "x": 1202.5,
        "y": 2901,
        "wires": []
    },
    {
        "id": "ee5f7e0b.b047e",
        "type": "link in",
        "z": "20c682c8.b59efe",
        "name": "restoreSD",
        "links": [
            "fb292dd6.88b8d"
        ],
        "x": 889,
        "y": 2865,
        "wires": [
            [
                "bf082093.4c803"
            ]
        ]
    },
    {
        "id": "fb292dd6.88b8d",
        "type": "link out",
        "z": "20c682c8.b59efe",
        "name": "restoreSD",
        "links": [
            "ee5f7e0b.b047e"
        ],
        "x": 1383,
        "y": 2943,
        "wires": []
    },
    {
        "id": "c6aaaa97.9d2138",
        "type": "link out",
        "z": "20c682c8.b59efe",
        "name": "setSettings",
        "links": [
            "a9ac35bc.552708"
        ],
        "x": 1203.5,
        "y": 2825,
        "wires": []
    },
    {
        "id": "a9ac35bc.552708",
        "type": "link in",
        "z": "20c682c8.b59efe",
        "name": "setSettings",
        "links": [
            "c6aaaa97.9d2138"
        ],
        "x": 695.5,
        "y": 2813,
        "wires": [
            [
                "704b3b45.1f3124"
            ]
        ]
    },
    {
        "id": "b6d017fa.163da8",
        "type": "ui_template",
        "z": "20c682c8.b59efe",
        "group": "236e90ca.4e1d",
        "name": "Settings page",
        "order": 3,
        "width": "6",
        "height": "6",
        "format": "<script>\n\nvar thedays2=[\"DOMENICA\",\"LUNEDI\",\"MARTEDI\",\"MERCOLEDI\",\"GIOVEDI\",\"VENERDI\",\"SABATO\"];\n\nvar ID2 = \"CC\";\n\nvar last2=29;\n\nfunction stat2(text)\n{\n$(\"#info\"+ID2).text(text);\nvar tm=setTimeout(function(){ $(\"#info\"+ID2).text(\"Ok\"); clearTimeout(tm);}, 3000);\n}\n\nfunction selec2(val,sta)\n{\nvar w=\"#td\"+val+ID2;\n if (sta) $(w).css('background-color','#4CAF50'); else $(w).css('background-color','#FFC107');\n}\n\n\n    (function(scope){\n        scope.ID2 = ID2;\n        scope.send({payload: '29'})\n        scope.$watch('msg', function(msg) {\n            selec2(last2,0); last2=msg.selector; selec2(last2,1);\n            for (var x=0; x<24; x++) \n                { \n                    var w=\"#t\"+x+ID2; bar(w,msg.timing[((msg.days-1)*24)+x]); \n                    var v=\"#v\"+x+ID2; $(v).text(msg.timing[((msg.days-1)*24)+x]+\"°\")\n                } \n            for (var x=0; x<2; x++) { var w=\"#s\"+x+ID2; $(w).text(msg.timing[168+x]); }\n             $(\"#d0\"+ID2).text(thedays2[msg.days-1]);\n             if ((last2>4) &&(last2<29))\n                 $(\"#current\"+ID2).text(msg.timing[((msg.days-1)*24)+last2-5] + \"°\");\n             else\n                 $(\"#current\"+ID2).text(\"-\");\n                 \n            if (msg.foryou!=\"\") { stat2(msg.foryou);  }\n            \n             \n        });\n \n    })(scope);\n      \n\n</script>\n<table width=\"100%\">\n    \n    <tr>\n        <td colspan=24><center><span class=\"smallheadings\" >Giorno</span></center></td>\n        <!--<td colspan=3><center><span class=\"smallheadings\">Clima</span></center></td>\n        <td colspan=3><center><span class=\"smallheadings\">Fuori casa</span></center></td>-->\n    </tr>\n   \n    <tr>\n        <td ng-click=\"send({payload: '29'})\" colspan=24><center><span id=\"{{ 'd0' + ID2 }}\" style=\"cursor:pointer;color:white;font-size:120%\">LUNEDI</span></center></td>\n        <!--<td ng-click=\"send({payload: '1'})\" colspan=3><center><span id=\"s0\" style=\"color:white;font-size:120%\">14</span></center></td>\n        <td ng-click=\"send({payload: '2'})\" colspan=3><center><span id=\"s1\" style=\"color:white;font-size:120%\">20</span></center></td>-->\n    </tr>\n    \n    <tr style=\"height:2px\">\n        <td id=\"{{ 'td29' + ID2 }}\" colspan=24 style=\"background-color:#9E9E9E;height:2px;\"></td>        \n       <!-- <td id=\"td1\" colspan=3 style=\"background-color:#9E9E9E;height:2px;\"></td>\n        <td id=\"td2\" colspan=3 style=\"background-color:#9E9E9E;height:2px;\"></td>-->\n    </tr>  \n\n    <tr>\n        <td ng-click=\"send({payload: '5'})\" class=\"thedays\"><span id=\"{{ 'v0' + ID2 }}\" class=\"thetemps\"></span><div id=\"{{ 't0' + ID2 }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '6'})\" class=\"thedays\"><span id=\"{{ 'v1' + ID2 }}\" class=\"thetemps\"></span><div id=\"{{ 't1' + ID2 }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '7'})\" class=\"thedays\"><span id=\"{{ 'v2' + ID2 }}\" class=\"thetemps\"></span><div id=\"{{ 't2' + ID2 }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '8'})\" class=\"thedays\"><span id=\"{{ 'v3' + ID2 }}\" class=\"thetemps\"></span><div id=\"{{ 't3' + ID2 }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '9'})\" class=\"thedays\"><span id=\"{{ 'v4' + ID2 }}\" class=\"thetemps\"></span><div id=\"{{ 't4' + ID2 }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '10'})\" class=\"thedays\"><span id=\"{{ 'v5' + ID2 }}\" class=\"thetemps\"></span><div id=\"{{ 't5' + ID2 }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '11'})\" class=\"thedays\"><span id=\"{{ 'v6' + ID2 }}\" class=\"thetemps\"></span><div id=\"{{ 't6' + ID2 }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '12'})\" class=\"thedays\"><span id=\"{{ 'v7' + ID2 }}\" class=\"thetemps\"></span><div id=\"{{ 't7' + ID2 }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '13'})\" class=\"thedays\"><span id=\"{{ 'v8' + ID2 }}\" class=\"thetemps\"></span><div id=\"{{ 't8' + ID2 }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '14'})\" class=\"thedays\"><span id=\"{{ 'v9' + ID2 }}\" class=\"thetemps\"></span><div id=\"{{ 't9' + ID2 }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '15'})\" class=\"thedays\"><span id=\"{{ 'v10' + ID2 }}\" class=\"thetemps\"></span><div id=\"{{ 't10' + ID2 }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '16'})\" class=\"thedays\"><span id=\"{{ 'v11' + ID2 }}\" class=\"thetemps\"></span><div id=\"{{ 't11' + ID2 }}\" class=\"theblocks\"></div></td>\n    </tr>  \n    \n    <tr style=\"height:2px\">\n        <td id=\"{{ 'td5' + ID2 }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td6' + ID2 }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td7' + ID2 }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td8' + ID2 }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td9' + ID2 }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td10' + ID2 }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td11' + ID2 }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td12' + ID2 }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td13' + ID2 }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td14' + ID2 }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td15' + ID2 }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td16' + ID2 }}\" class=\"the2px\"></td>\n    </tr>   \n    \n    <tr>\n        <td align=\"center\">0</td>\n        <td align=\"center\">1</td>\n        <td align=\"center\">2</td>\n        <td align=\"center\">3</td>\n        <td align=\"center\">4</td>\n        <td align=\"center\">5</td>\n        <td align=\"center\">6</td>\n        <td align=\"center\">7</td>\n        <td align=\"center\">8</td>\n        <td align=\"center\">9</td>\n        <td align=\"center\">10</td>\n        <td align=\"center\">11</td>\n    </tr> \n    \n    <tr>\n        <td ng-click=\"send({payload: '17'})\" class=\"thedays\"><span id=\"{{ 'v12' + ID2 }}\" class=\"thetemps\"></span><div id=\"{{ 't12' + ID2 }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '18'})\" class=\"thedays\"><span id=\"{{ 'v13' + ID2 }}\" class=\"thetemps\"></span><div id=\"{{ 't13' + ID2 }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '19'})\" class=\"thedays\"><span id=\"{{ 'v14' + ID2 }}\" class=\"thetemps\"></span><div id=\"{{ 't14' + ID2 }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '20'})\" class=\"thedays\"><span id=\"{{ 'v15' + ID2 }}\" class=\"thetemps\"></span><div id=\"{{ 't15' + ID2 }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '21'})\" class=\"thedays\"><span id=\"{{ 'v16' + ID2 }}\" class=\"thetemps\"></span><div id=\"{{ 't16' + ID2 }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '22'})\" class=\"thedays\"><span id=\"{{ 'v17' + ID2 }}\" class=\"thetemps\"></span><div id=\"{{ 't17' + ID2 }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '23'})\" class=\"thedays\"><span id=\"{{ 'v18' + ID2 }}\" class=\"thetemps\"></span><div id=\"{{ 't18' + ID2 }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '24'})\" class=\"thedays\"><span id=\"{{ 'v19' + ID2 }}\" class=\"thetemps\"></span><div id=\"{{ 't19' + ID2 }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '25'})\" class=\"thedays\"><span id=\"{{ 'v20' + ID2 }}\" class=\"thetemps\"></span><div id=\"{{ 't20' + ID2 }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '26'})\" class=\"thedays\"><span id=\"{{ 'v21' + ID2 }}\" class=\"thetemps\"></span><div id=\"{{ 't21' + ID2 }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '27'})\" class=\"thedays\"><span id=\"{{ 'v22' + ID2 }}\" class=\"thetemps\"></span><div id=\"{{ 't22' + ID2 }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '28'})\" class=\"thedays\"><span id=\"{{ 'v23' + ID2 }}\" class=\"thetemps\"></span><div id=\"{{ 't23' + ID2 }}\" class=\"theblocks\"></div></td>\n    </tr>  \n    \n    <tr style=\"height:2px\">\n        <td id=\"{{ 'td17' + ID2 }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td18' + ID2 }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td19' + ID2 }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td20' + ID2 }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td21' + ID2 }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td22' + ID2 }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td23' + ID2 }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td24' + ID2 }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td25' + ID2 }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td26' + ID2 }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td27' + ID2 }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td28' + ID2 }}\" class=\"the2px\"></td>\n    </tr>  \n    \n    <tr>\n        <td align=\"center\">12</td>\n        <td align=\"center\">13</td>\n        <td align=\"center\">14</td>\n        <td align=\"center\">15</td>\n        <td align=\"center\">16</td>\n        <td align=\"center\">17</td>\n        <td align=\"center\">18</td>\n        <td align=\"center\">19</td>\n        <td align=\"center\">20</td>\n        <td align=\"center\">21</td>\n        <td align=\"center\">22</td>\n        <td align=\"center\">23</td>\n    </tr> \n    \n    <tr height=\"20px\">\n        <td colspan=2 class=\"smallheadings\">Azioni:</td>\n\n        <td colspan=10 ><center><span id=\"{{ 'info' + ID2 }}\" class=\"smallheadings\" ></span></center></td>\n\n    </tr>\n    \n    <tr height=\"10px\">\n        <td colspan=\"12\"></td>\n    </tr>\n\n    <tr style=\"height:48px\">\n        <td colspan=2>\n            <button class=\"vibrate filled touched smallfont rounded greybuttons\" ng-click=\"send({payload: 'd'})\"> \n               <ng-md-icon style=\"color: #fff;\" icon=\"keyboard_arrow_down\">\n                    <md-tooltip md-direction=\"bottom\">DECREMENTA</md-tooltip>\n                </ng-md-icon>\n            </button> \n        </td>\n        \n        <td colspan=2><center><span id=\"{{ 'current' + ID2 }}\" style=\"color:white;font-size:120%\">-</span></center></td>\n\n        <td colspan=2>\n            <button class=\"vibrate filled touched smallfont rounded greybuttons\" ng-click=\"send({payload: 'u'})\"> \n               <ng-md-icon style=\"color: #fff;\" icon=\"keyboard_arrow_up\">\n                    <md-tooltip md-direction=\"bottom\">INCREMENTA</md-tooltip>\n                </ng-md-icon>\n            </button> \n        </td>\n\n        <td colspan=2>\n            <button class=\"vibrate filled touched smallfont rounded greybuttons\" ng-click=\"send({payload: 'r'})\"> \n               <ng-md-icon style=\"color: #fff;\" icon=\"content_copy\">\n                    <md-tooltip md-direction=\"bottom\">COPIA</md-tooltip>\n                </ng-md-icon>\n            </button> \n        </td>\n\n\n        <td colspan=2>\n            <button class=\"vibrate filled touched smallfont rounded greybuttons\" ng-click=\"send({payload: 's'})\"> \n                 <ng-md-icon style=\"color: #fff;\" icon=\"save\">\n                    <md-tooltip md-direction=\"bottom\">SALVA</md-tooltip>\n                </ng-md-icon>\n            </button> \n        </td>\n\n        <td colspan=2>\n            <button class=\"vibrate filled touched smallfont rounded greybuttons\"  ng-click=\"send({payload: 'c'})\"> \n                 <ng-md-icon style=\"color: #fff;\" icon=\"cancel\">\n                    <md-tooltip md-direction=\"bottom\">ANNULLA</md-tooltip>\n                </ng-md-icon>\n            </button> \n        </td>\n        <td colspan=1></td>\n    </tr>\n\n</table>",
        "storeOutMessages": false,
        "fwdInMessages": false,
        "x": 797,
        "y": 2396,
        "wires": [
            [
                "88e4a065.23fa7"
            ]
        ]
    },
    {
        "id": "88e4a065.23fa7",
        "type": "function",
        "z": "20c682c8.b59efe",
        "name": "Process controls",
        "func": "if ( typeof context.days2 == 'undefined' ) context.days2=1;\nif ( typeof context.selector2 == 'undefined' ) context.selector2=29;\nif ( typeof context.saving2 == 'undefined' ) context.saving2=1;\nif ( typeof context.global.timing2 == 'undefined' ) \n    {\n        context.global.timing2=[\n                        14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n                        14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n                        14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n                        14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n                        14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n                        14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n                        14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n                        6,14\n                        ];\n        context.saving2=1;                    \n    }\nvar timing2=global.get(\"timing2\");\n\nswitch (msg.payload)\n    {\n    case \"u\" :  if ((context.selector2>4)&&(context.selector2<29))\n                {\n                    timing2[((context.days2-1)*24)+context.selector2-5]++; \n                    if (timing2[((context.days2-1)*24)+context.selector2-5]>26){ timing2[((context.days2-1)*24)+context.selector2-5]=26; msg.foryou=\"Limite raggiunto\";}\n                    else msg.foryou=\"Temperatura aumentata\";\n                }\n                if (context.selector2==1) { if (timing2[168+(context.selector2-1)]<26) {  timing2[168+(context.selector2-1)]++; msg.foryou=\"Temperatura clima aumentata di 1°C\"; } else msg.foryou=\"Limite raggiunto\"; }\n                if (context.selector2==2) { if (timing2[168+(context.selector2-1)]<26) {  timing2[168+(context.selector2-1)]++; msg.foryou=\"Temperatura fuori casa aumentata di 1°C\"; } else msg.foryou=\"Limite raggiunto\"; }\n                if (context.selector2==29) { msg.foryou=\"Giorno successivo\"; context.days2++; if (context.days2>7) { context.days2 = 1; } }\n                break;\n    case \"d\" :  if ((context.selector2>4)&&(context.selector2<29))\n                {\n                    timing2[((context.days2-1)*24)+context.selector2-5]--; \n                    if (timing2[((context.days2-1)*24)+context.selector2-5]<14){ timing2[((context.days2-1)*24)+context.selector2-5]=14; msg.foryou=\"Limite raggiunto\";}\n                    else msg.foryou=\"Temperatura decrementata\";\n                }\n                if (context.selector2==1) { if (timing2[168+(context.selector2-1)]>12) { timing2[168+(context.selector2-1)]--; msg.foryou=\"Temperatura clima diminuita di 1°C\"; } else msg.foryou=\"Limite raggiunto\"; }\n                if (context.selector2==2) { if (timing2[168+(context.selector2-1)]>12) { timing2[168+(context.selector2-1)]--; msg.foryou=\"Temperatura fuori casa diminuita di 1°C\"; } else msg.foryou=\"Limite raggiunto\"; }\n                if (context.selector2==29) {  msg.foryou=\"Giorno precedente\";  context.days2--; if (context.days2 < 1) { context.days2 = 7;  } }\n                break;\n    case 'r' :  if ((context.selector2>=5)&&(context.selector2<28))\n                        {\n                         timing2[((context.days2-1)*24)+context.selector2-4]=timing2[((context.days2-1)*24)+context.selector2-5];   \n                         context.selector2++;\n                         msg.foryou=\"Temperatura copiata nello slot successivo\";\n                        }\n                if ((context.selector2==29)&&(context.days2<7))\n                        {\n                         for (var a=0;a<24;a++)\n                            {\n                             timing2[((context.days2)*24)+a]=timing2[((context.days2-1)*24)+a];   \n                            }\n                         context.days2++;\n                         msg.foryou=\"Impostazioni copiate nel giorno successivo\";\n                        }\n                        else if(context.days2==7)\n                            msg.foryou=\"Fine della settimana raggiunto!\";\n                break;\n    case 's': context.saving2=0;  msg.foryou=\"Impostazioni salvate\"; break;\n    case '1':\n    case '2':\n    case '3':\n    case '4':\n    case '5':\n    case '6':\n    case '7':\n    case '8':\n    case '9':\n    case '10':\n    case '11':\n    case '12':\n    case '13':\n    case '14':\n    case '15':\n    case '16':\n    case '17':\n    case '18':\n    case '19':\n    case '20':\n    case '21':\n    case '22':\n    case '23':\n    case '24':\n    case '25':\n    case '26':\n    case '27':\n    case '28':\n    case '29': context.selector2=parseInt(msg.payload);\n               if (msg.payload=='1') msg.foryou=\"Temperatura clima selezionata\"; \n               else if (msg.payload=='2') msg.foryou=\"Temperatura fuori casa selezionata\";\n               else if (msg.payload=='29') msg.foryou=\"Giorno selezionato\";\n               else  msg.foryou=\"Regolazione temperatura ore: \" + (parseInt(msg.payload)-5);\n    break;\n    case 'c' : msg.payload=\"niente\";  msg.foryou=\"Cambiamenti annullati\"; node.send([null,null,msg]);\n    }\n\nmsg.temperatures=context.temperatures2;\nmsg.timing=timing2;\nmsg.days=context.days2;\nmsg.selector=context.selector2;\n\nnode.send([msg,null,null]);\n\nif (context.saving2===0) \n    { \n       msg.topic=\"\";\n        msg.timing=\"\";\n        msg.payload=JSON.stringify(timing2);\n        node.send([null,msg,null]); \n        context.saving2=1;\n    }\n    msg.foryou=\"\"",
        "outputs": "3",
        "noerr": 0,
        "x": 1020,
        "y": 2448,
        "wires": [
            [
                "787260d9.66ad9"
            ],
            [
                "1cf6f89b.0d45f7"
            ],
            [
                "7cc9f964.94edb8"
            ]
        ]
    },
    {
        "id": "1376f982.4b3f46",
        "type": "inject",
        "z": "20c682c8.b59efe",
        "name": "Once only",
        "repeat": "",
        "crontab": "",
        "once": true,
        "topic": "",
        "payload": "",
        "payloadType": "str",
        "x": 805,
        "y": 2496,
        "wires": [
            [
                "88e4a065.23fa7",
                "1fa5b8d5.a8f1a7"
            ]
        ]
    },
    {
        "id": "ff3e7711.dd7228",
        "type": "inject",
        "z": "20c682c8.b59efe",
        "name": "Every minute",
        "repeat": "60",
        "crontab": "",
        "once": true,
        "topic": "",
        "payload": "",
        "payloadType": "str",
        "x": 778,
        "y": 2617,
        "wires": [
            [
                "4551bad1.cec7f4"
            ]
        ]
    },
    {
        "id": "d4a44a33.0d3668",
        "type": "function",
        "z": "20c682c8.b59efe",
        "name": "Process heat",
        "func": "var timing=global.get(\"timing2\");\nvar now = new Date(msg.time);\nmsg.payload=timing[(now.getDay()*24)+now.getHours()];\nmsg.frost=timing[168];\nmsg.away=timing[169];\nnode.status({fill:\"blue\",shape:\"dot\",text:\"Set point \" + msg.payload + \"°C\"});\nreturn msg;\n\n",
        "outputs": 1,
        "noerr": 0,
        "x": 1106,
        "y": 2616,
        "wires": [
            [
                "9c47a8c8.854af8"
            ]
        ]
    },
    {
        "id": "1cf6f89b.0d45f7",
        "type": "file",
        "z": "20c682c8.b59efe",
        "name": "backup",
        "filename": "/home/pi/data/thermo_scheduler_02.log",
        "appendNewline": true,
        "createDir": true,
        "overwriteFile": "true",
        "x": 1209,
        "y": 2447,
        "wires": [
            []
        ]
    },
    {
        "id": "1fa5b8d5.a8f1a7",
        "type": "file in",
        "z": "20c682c8.b59efe",
        "name": "Restore",
        "filename": "/home/pi/data/thermo_scheduler_02.log",
        "format": "utf8",
        "x": 998,
        "y": 2526,
        "wires": [
            [
                "5bd619d6.24d808"
            ]
        ]
    },
    {
        "id": "5bd619d6.24d808",
        "type": "function",
        "z": "20c682c8.b59efe",
        "name": "Restore data from SD",
        "func": "context.global.timing2=JSON.parse(msg.payload);\nmsg.payload=\"\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1198,
        "y": 2526,
        "wires": [
            [
                "f47b6ebc.28d9b"
            ]
        ]
    },
    {
        "id": "9c47a8c8.854af8",
        "type": "debug",
        "z": "20c682c8.b59efe",
        "name": "",
        "active": true,
        "console": "false",
        "complete": "true",
        "x": 1274.5,
        "y": 2617,
        "wires": []
    },
    {
        "id": "427f8802.d22818",
        "type": "link in",
        "z": "20c682c8.b59efe",
        "name": "restore",
        "links": [
            "7cc9f964.94edb8"
        ],
        "x": 858.5,
        "y": 2547,
        "wires": [
            [
                "1fa5b8d5.a8f1a7"
            ]
        ]
    },
    {
        "id": "7cc9f964.94edb8",
        "type": "link out",
        "z": "20c682c8.b59efe",
        "name": "restore",
        "links": [
            "427f8802.d22818"
        ],
        "x": 1171.5,
        "y": 2484,
        "wires": []
    },
    {
        "id": "114e243a.951acc",
        "type": "link in",
        "z": "20c682c8.b59efe",
        "name": "restoreSD",
        "links": [
            "f47b6ebc.28d9b"
        ],
        "x": 858,
        "y": 2448,
        "wires": [
            [
                "88e4a065.23fa7"
            ]
        ]
    },
    {
        "id": "f47b6ebc.28d9b",
        "type": "link out",
        "z": "20c682c8.b59efe",
        "name": "restoreSD",
        "links": [
            "114e243a.951acc"
        ],
        "x": 1352,
        "y": 2526,
        "wires": []
    },
    {
        "id": "787260d9.66ad9",
        "type": "link out",
        "z": "20c682c8.b59efe",
        "name": "setSettings",
        "links": [
            "393cb66c.d9602a"
        ],
        "x": 1172.5,
        "y": 2408,
        "wires": []
    },
    {
        "id": "393cb66c.d9602a",
        "type": "link in",
        "z": "20c682c8.b59efe",
        "name": "setSettings",
        "links": [
            "787260d9.66ad9"
        ],
        "x": 664.5,
        "y": 2396,
        "wires": [
            [
                "b6d017fa.163da8"
            ]
        ]
    },
    {
        "id": "cccb363c.b966b8",
        "type": "comment",
        "z": "20c682c8.b59efe",
        "name": "EDIT",
        "info": "Settings page:\n-thedays2\n-ID2\n-last2\n-bar2\n-stat2\n-selec2\n\nProcess controls\n-days2\n-selector2\n-saving2\n-timing2\n-temperatures2\n\nRestore data from SD\n-timing2\n\nProcess heat\n-timing2\n\nBackup/Restore File read\nchange name of the file .log",
        "x": 591.5,
        "y": 1530,
        "wires": []
    },
    {
        "id": "8ab4f286.9e135",
        "type": "moment",
        "z": "20c682c8.b59efe",
        "name": "",
        "topic": "",
        "input": "payload",
        "inputType": "msg",
        "inTz": "UTC",
        "adjAmount": "2",
        "adjType": "hours",
        "adjDir": "add",
        "format": "lll",
        "locale": "it_IT",
        "output": "payload",
        "outputType": "msg",
        "outTz": "UTC",
        "x": 888,
        "y": 3317,
        "wires": [
            [
                "1b39179f.d8dd28"
            ]
        ]
    },
    {
        "id": "aaff02d9.db667",
        "type": "moment",
        "z": "20c682c8.b59efe",
        "name": "time",
        "topic": "",
        "input": "",
        "inputType": "date",
        "inTz": "UTC",
        "adjAmount": "2",
        "adjType": "hours",
        "adjDir": "add",
        "format": "",
        "locale": "it_IT",
        "output": "time",
        "outputType": "msg",
        "outTz": "UTC",
        "x": 826.5,
        "y": 1838,
        "wires": [
            [
                "94288cf.ccce97"
            ]
        ]
    },
    {
        "id": "4bec742d.96ebdc",
        "type": "moment",
        "z": "20c682c8.b59efe",
        "name": "time",
        "topic": "",
        "input": "",
        "inputType": "date",
        "inTz": "UTC",
        "adjAmount": "2",
        "adjType": "hours",
        "adjDir": "add",
        "format": "",
        "locale": "it_IT",
        "output": "time",
        "outputType": "msg",
        "outTz": "UTC",
        "x": 916.5,
        "y": 2199,
        "wires": [
            [
                "cc0da780.529c58"
            ]
        ]
    },
    {
        "id": "49c192d2.21910c",
        "type": "moment",
        "z": "20c682c8.b59efe",
        "name": "time",
        "topic": "",
        "input": "",
        "inputType": "date",
        "inTz": "UTC",
        "adjAmount": "2",
        "adjType": "hours",
        "adjDir": "add",
        "format": "",
        "locale": "it_IT",
        "output": "time",
        "outputType": "msg",
        "outTz": "UTC",
        "x": 974.5,
        "y": 3034,
        "wires": [
            [
                "c2b276d.3897a88"
            ]
        ]
    },
    {
        "id": "4551bad1.cec7f4",
        "type": "moment",
        "z": "20c682c8.b59efe",
        "name": "time",
        "topic": "",
        "input": "",
        "inputType": "date",
        "inTz": "UTC",
        "adjAmount": "2",
        "adjType": "hours",
        "adjDir": "add",
        "format": "",
        "locale": "it_IT",
        "output": "time",
        "outputType": "msg",
        "outTz": "UTC",
        "x": 943.5,
        "y": 2617,
        "wires": [
            [
                "d4a44a33.0d3668"
            ]
        ]
    }
]